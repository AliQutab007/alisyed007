<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="description" content="Onslaught! Arena is an HTML5 game made by Lost Decade Games. Fight off the horde with medieval weapons and powerups!">
	<meta name="keywords" content="onslaught arena, html5, chrome webstore, indie, browser-based, lost decade games, javascript, chiptunes, arcade, retro, oldschool, geoff blair, matt hackett, joshua morse">
	<link rel="icon" href="img/favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="css/horde.css?v=1.3.1">
	<title>Onslaught! Arena</title>
</head>
<body class="full">

	<div class="hidden">
		<h1>Onslaught! Arena</h1>
		<p>
			<strong>Onslaught! Arena</strong>
			is an HTML5 game made by <a href="http://www.lostdecadegames.com/">Lost Decade Games</a>.
		</p>
	</div>

	<div class="nav">
		<ul>
			<li><a href="http://www.lostdecadegames.com" target="_blank">Blog</a></li>
			<li><a href="http://goo.gl/WbQQ3" target="_blank">Twitter</a></li>
			<li><a href="http://goo.gl/CNHBo" target="_blank">Facebook</a></li>
		</ul>
	</div>

	<div class="ad leaderboard">
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-1209743261472499";
	/* onslaugh_arena_demo_1 */
	google_ad_slot = "1042513023";
	google_ad_width = 728;
	google_ad_height = 90;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>


	<div id="stage">
		<div id="tip">
			<div id="tip_message">
				<span>Enjoy the demo!</span>
				Buy the full version on the
				<a href="http://goo.gl/COiGK" target="_blank">Chrome Web Store</a>
				or
				<a href="http://itunes.apple.com/us/app/onslaught-arena/id418268106" target="_blank">Mac App Store</a>
				!
			</div>
		</div>
	</div>

	<script>
	/*
	This content (c) copyright 2010 Lost Decade Games, LLC.
	Guys, we worked hard on this. Please don't do anything shady with it.
	Thanks!
	*/
	(function () {
		(function(){var c={canvasFallbackContent:'<div class="fallback"><p>Your browser does not appear to support <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>.</p><p>Please try one of the following, more standards compliant browsers: <a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.apple.com/safari/">Safari</a>, <a href="http://www.mozilla.com/firefox/">Firefox</a> or <a href="http://www.opera.com/">Opera</a>.</p></div>'};if("undefined"==typeof w)var w=window.mozRequestAnimationFrame||
window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(function(){a(Date.now())},17)};c.setInterval=function(a,b,c){return window.setInterval(function(){b.call(c)},a)};c.setTimeout=function(a,b,c){return window.setTimeout(function(){b.call(c)},a)};c.on=function(a,b,c,n){c.addEventListener(a,function(a){b.call(n,a)},!1)};c.stopEvent=function(a){a.cancelBubble=!0;a.stopPropagation();a.preventDefault()};c.now=function(){return Date.now()};
c.makeCanvas=function(a,b,g,n){var d=document.createElement("canvas");d.id=a;d.width=Number(b)||0;d.height=Number(g)||0;!0!==n&&(d.innerHTML=c.canvasFallbackContent,document.getElementById("stage").appendChild(d));return d};c.getOffset=function(a){for(var b={x:a.offsetLeft,y:a.offsetTop};;){a=a.parentNode;if(a===document.body)break;b.x+=a.offsetLeft;b.y+=a.offsetTop}scrollTop=c.getScrollTop();b.x-=scrollTop.x;b.y-=scrollTop.y;return b};c.getScrollTop=function(){if("undefined"!==typeof pageYOffset)return{x:pageXOffset,
y:pageYOffset};var a=document.body,b=document.documentElement,b=b.clientHeight?b:a;return{x:b.scrollLeft,y:b.scrollTop}};c.randomRange=function(a,b){return Math.round(Math.random()*(b-a))+a};c.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};c.randomDirection=function(){var a=new c.Vector2(c.randomRange(-10,10),c.randomRange(-10,10));a.normalize();return a};c.makeObject=function(a,b){var g=new c.Object;g.type=a;for(var n in c.objectTypes[a])g[n]=c.objectTypes[a][n];!0!==b&&g.init();return g};
c.directions={UP:0,UP_RIGHT:1,RIGHT:2,DOWN_RIGHT:3,DOWN:4,DOWN_LEFT:5,LEFT:6,UP_LEFT:7,toVector:function(a){0>a&&(a+=8);7<a&&(a-=8);switch(a){case c.directions.UP:return new c.Vector2(0,-1);case c.directions.UP_RIGHT:return new c.Vector2(1,-1);case c.directions.RIGHT:return new c.Vector2(1,0);case c.directions.DOWN_RIGHT:return new c.Vector2(1,1);case c.directions.DOWN:return new c.Vector2(0,1);case c.directions.DOWN_LEFT:return new c.Vector2(-1,1);case c.directions.LEFT:return new c.Vector2(-1,0);
case c.directions.UP_LEFT:return new c.Vector2(-1,-1)}},fromVector:function(a){if(-0.25<a.x&&0.25>a.x&&0>a.y)return c.directions.UP;if(-0.25<a.x&&0.25>a.x&&0<a.y)return c.directions.DOWN;if(0<a.x&&-0.25<a.y&&0.25>a.y)return c.directions.RIGHT;if(0>a.x&&-0.25<a.y&&0.25>a.y)return c.directions.LEFT;if(0<a.x&&0>a.y)return c.directions.UP_RIGHT;if(0<a.x&&0<a.y)return c.directions.DOWN_RIGHT;if(0>a.x&&0<a.y)return c.directions.DOWN_LEFT;if(0>a.x&&0>a.y)return c.directions.UP_LEFT}};c.x=function(a,b){for(var c=
0,n="",d=0;d<b.length;++d)c+=b.charCodeAt(d);for(d=0;d<a.length;++d)n+=String.fromCharCode(c^a.charCodeAt(d));return n};var y=[];c.log=function(a){y.push(a);console.log(a)};c.Timer=function(){this.ttl=this.elapsed_ms=0};var d=c.Timer,h=d.prototype;d.now=function(){return Date.now()};h.start=function(a){a&&(this.ttl=Number(a));this.elapsed_ms=0};h.update=function(a){this.elapsed_ms+=a};h.reset=function(){this.start()};h.elapsed=function(){return this.elapsed_ms};h.expired=function(){return 0<this.ttl?
this.elapsed_ms>this.ttl:!1};c.sound={};var q="html5",u=!1,p={},s=!1;c.sound.init=function(a){if("undefined"==typeof Audio)s=!0;else switch(s=!1,q){case "ios":a();break;case "sm2":soundManager.useFastPolling=!0;soundManager.useHighPerformance=!0;soundManager.autoLoad=!0;soundManager.multiShot=!0;soundManager.volume=100;soundManager.onload=a;soundManager.useHTML5Audio=!1;var b=arguments.callee;soundManager.onerror=function(){q="html5";b(a)};break;case "html5":var c=document.createElement("audio");
c.canPlayType&&(c.canPlayType("audio/mpeg;")||(q=null));a()}};c.sound.create=function(a,b,c,n){if(!s)switch(c=Boolean(c),b+=".mp3",void 0===n&&(n=100),q){case "sm2":a={id:a,url:b,volume:n};c&&(a.onfinish=function(){this.play()});soundManager.createSound(a).load();break;case "html5":var d=new Audio;d.preload="auto";d.src=b;c?d.addEventListener("ended",function(){this.currentTime=0;this.play()},!1):d.addEventListener("ended",function(){this.pause();this.currentTime=0},!1);d.load();d.volume=n/100;p[a]=
d}};c.sound.isPlaying=function(a){if(!s)switch(q){case "sm2":return(a=soundManager.getSoundById(a))?1===a.playState:!1;case "html5":return 0<p[a].currentTime}};c.sound.play=function(a){if(!s){if(u)return!1;switch(q){case "ios":location.href="jsbridge://"+a;break;case "sm2":soundManager.play(a);break;case "html5":try{p[a].pause(),p[a].currentTime=0,p[a].play()}catch(b){}}}};c.sound.stop=function(a){if(!s)switch(q){case "sm2":soundManager.stop(a);break;case "html5":p[a].pause(),p[a].currentTime=0}};
c.sound.stopAll=function(){if(!s)switch(q){case "sm2":soundManager.stopAll();break;case "html5":try{for(var a in p)p[a].pause(),p[a].currentTime=0}catch(b){console.log("[ERROR horde.sound.stopAll]",b)}}};c.sound.pauseAll=function(){if(!s)switch(q){case "sm2":soundManager.pauseAll();break;case "html5":for(var a in p)0<p[a].currentTime&&p[a].pause()}};c.sound.resumeAll=function(){if(!s)switch(q){case "sm2":soundManager.resumeAll();break;case "html5":for(var a in p)0<p[a].currentTime&&p[a].play()}};
c.sound.toggleMuted=function(){c.sound.setMuted(!c.sound.isMuted())};c.sound.isMuted=function(){return u};c.sound.setMuted=function(a){u!==a&&((u=a)?c.sound.pauseAll():c.sound.resumeAll())};c.Size=function(a,b){this.width=Number(a)||0;this.height=Number(b)||0};c.Vector2=function(a,b){this.x=Number(a)||0;this.y=Number(b)||0};d=c.Vector2;h=d.prototype;d.fromSize=function(a){return new c.Vector2(a.width,a.height)};d.fromHeading=function(a,b){b=Number(b)||1;return new c.Vector2(Math.sin(a)*b,-Math.cos(a)*
b)};h.clone=function(){return new c.Vector2(this.x,this.y)};h.scale=function(a){this.x*=a;this.y*=a;return this};h.add=function(a){this.x+=a.x;this.y+=a.y;return this};h.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};h.zero=function(){this.y=this.x=0;return this};h.invert=function(){this.x*=-1;this.y*=-1;return this};h.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};h.normalize=function(){var a=this.magnitude();return 0===a?this:this.scale(1/a)};h.toString=function(){return this.x+
", "+this.y};h.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};h.abs=function(){this.x=Math.abs(this.x);this.y=Math.abs(this.y);return this};h.angle=function(){return this.heading()*(180/Math.PI)};h.heading=function(){return Math.atan2(this.x,-this.y)};c.Rect=function(a,b,c,n){this.left=Number(a)||0;this.top=Number(b)||0;this.width=Number(c)||0;this.height=Number(n)||0};var v=c.Rect,d=v.prototype;v.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+
a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};d.center=function(){var a=new c.Vector2(this.width,this.height);return(new c.Vector2(this.left,this.top)).add(a.scale(0.5))};d.intersects=function(a){return v.intersects(this,a)};d.reduce=function(a){this.left+=a;this.top+=a;this.width-=2*a;this.height-=2*a;return this};c.Keyboard=function(){this.history=[];this.keyStates={};this.lastKeyStates={};c.on("keydown",this.handleKeyDown,window,this);c.on("keyup",this.handleKeyUp,window,this)};var d=
c.Keyboard,h=d.prototype,e={ESCAPE:27,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,D:68,E:69,F:70,G:71,K:75,L:76,M:77,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,W:87,X:88,Z:90};d.Keys=e;d.konamiCode=[e.UP,e.UP,e.DOWN,e.DOWN,e.LEFT,e.RIGHT,e.LEFT,e.RIGHT,e.B,e.A];d.debugCode=[e.L,e.D,e.D,e.E,e.B,e.U,e.G];d.resetCode=[e.L,e.D,e.R,e.E,e.S,e.E,e.T];d.godModeCode=[e.L,e.D,e.D,e.Q,e.D];d.allWeaponsCode=[e.L,e.D,e.K,e.F,e.A];d.awesmCode=[e.A,e.W,e.E,e.S,e.M];d.bombCode=[e.L,e.D,e.B,e.O,e.M,e.B];d.cyclopsCode=
[67,89,67,e.L,e.O,e.P,e.S];d.html5Code=[72,84,77,76,53];d.meatboyCode=[e.M,e.E,e.A,e.T];h.supressKeys=function(a){switch(a.keyCode){case e.ENTER:case e.LEFT:case e.UP:case e.RIGHT:case e.DOWN:case e.B:case e.A:case e.M:case e.Z:case e.X:case e.P:case e.SPACE:case e.W:case e.S:case e.D:case 191:c.stopEvent(a)}};h.handleKeyDown=function(a){this.history.push(a.keyCode);this.keyStates[a.keyCode]=!0;this.supressKeys(a)};h.handleKeyUp=function(a){this.keyStates[a.keyCode]=!1;this.supressKeys(a)};h.isKeyDown=
function(a){return!0===this.keyStates[a]};h.isKeyPressed=function(a){return this.isKeyDown(a)&&!0!==this.lastKeyStates[a]};h.isAnyKeyPressed=function(a){for(a in this.keyStates)if(this.isKeyDown(a)&&!0!==this.lastKeyStates[a])return!0;return!1};h.clearKey=function(a){this.keyStates[a]=!1};h.clearKeys=function(){this.keyStates={}};h.clearHistory=function(){this.history=[]};h.historyMatch=function(a){var b=a.length,c=this.history.slice(-b);if(c.length!==b)return!1;for(var n=0;n<b;n++)if(a[n]!==c[n])return!1;
return!0};h.storeKeyStates=function(){for(var a in this.keyStates)this.lastKeyStates[a]=this.keyStates[a]};c.Mouse=function(a){this.buttonStates={};this.mouseY=this.mouseX=0;this.canvas=a;this.lastButtonStates={};c.on("mousemove",this.handleMouseMove,a,this);c.on("mousedown",this.handleMouseDown,a,this);c.on("mouseup",this.handleMouseUp,window,this)};d=c.Mouse;h=d.prototype;d.Buttons={LEFT:0,RIGHT:2};h.handleMouseMove=function(a){var b=c.getOffset(this.canvas);this.mouseX=640*(a.clientX-b.x)/this.canvas.offsetWidth;
this.mouseY=480*(a.clientY-b.y)/this.canvas.offsetHeight;this.hasMoved=!0};h.handleMouseDown=function(a){this.buttonStates[a.button]=!0;c.stopEvent(a);window.focus&&window.focus()};h.handleMouseUp=function(a){this.buttonStates[a.button]=!1};h.isButtonDown=function(a){return this.buttonStates[a]};h.isAnyButtonDown=function(){for(var a in this.buttonStates)if(this.buttonStates[a])return!0;return!1};h.clearButtons=function(){this.buttonStates={}};h.wasButtonClicked=function(a){return this.buttonStates[a]&&
!this.lastButtonStates[a]};h.storeButtonStates=function(){for(var a in this.buttonStates)this.lastButtonStates[a]=this.buttonStates[a]};c.isDemo=function(){return!1};c.populateWaves=function(a){var b=new c.SpawnWave;b.addSpawnPoint(0,1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,1E3);b.addObjects(0,"bat",1);b.addObjects(1,"bat",1);b.addObjects(2,"bat",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,1E3);b.addObjects(0,"goblin",2);b.addObjects(1,
"goblin",2);b.addObjects(2,"goblin",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(1,1E3);b.addObjects(1,"cyclops",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,1E3);b.addObjects(0,"demoblin",2);b.addObjects(1,"demoblin",3);b.addObjects(2,"demoblin",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,500);b.addSpawnPoint(1,750);b.addSpawnPoint(2,500);b.addObjects(0,"bat",5);b.addObjects(0,"goblin",2);b.addObjects(1,"goblin",2);b.addObjects(1,
"cyclops",1);b.addObjects(1,"goblin",3);b.addObjects(2,"bat",5);b.addObjects(2,"goblin",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,200);b.addSpawnPoint(1,200);b.addSpawnPoint(2,200);b.addObjects(0,"bat",10);b.addObjects(1,"bat",10);b.addObjects(2,"bat",10);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,1E3);b.addObjects(0,"demoblin",3);b.addObjects(1,"cyclops",1);b.addObjects(1,"goblin",5);b.addObjects(2,"demoblin",3);a.waves.push(b);
b=new c.SpawnWave;b.addSpawnPoint(0,5E3);b.addSpawnPoint(1,1500);b.addSpawnPoint(2,5E3);b.addObjects(0,"imp",5);b.addObjects(1,"imp",10);b.addObjects(2,"imp",5);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,750);b.addSpawnPoint(1,750);b.addSpawnPoint(2,750);b.addObjects(0,"cyclops",1);b.addObjects(2,"cyclops",1);b.addObjects(0,"bat",10);b.addObjects(1,"bat",10);b.addObjects(2,"bat",10);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(1,1E3);b.addObjects(1,"cube",1);b.bossWave=!0;b.bossName=
"Gelatinous Cube";a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,2E4);b.addSpawnPoint(1,2E4);b.addSpawnPoint(2,2E4);b.addObjects(0,"sandworm",2);b.addObjects(1,"sandworm",2);b.addObjects(2,"sandworm",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1E4);b.addSpawnPoint(1,1E4);b.addSpawnPoint(2,1E4);b.addObjects(0,"wizard",2);b.addObjects(1,"wizard",2);b.addObjects(2,"wizard",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,7500);b.addSpawnPoint(1,7500);b.addSpawnPoint(2,7500);b.addObjects(0,
"flaming_skull",2);b.addObjects(1,"flaming_skull",2);b.addObjects(2,"flaming_skull",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,15E3);b.addSpawnPoint(1,1500);b.addSpawnPoint(2,15E3);b.addObjects(0,"owlbear",1);b.addObjects(2,"owlbear",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,1E3);b.addObjects(0,"huge_skull",1);b.addObjects(1,"huge_skull",1);b.addObjects(2,"huge_skull",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,500);
b.addSpawnPoint(1,4E3);b.addSpawnPoint(2,500);b.addObjects(0,"dire_bat",5);b.addObjects(0,"hunter_goblin",2);b.addObjects(0,"dire_bat",5);b.addObjects(0,"hunter_goblin",2);b.addObjects(1,"sandworm",2);b.addObjects(2,"dire_bat",5);b.addObjects(2,"hunter_goblin",2);b.addObjects(2,"dire_bat",5);b.addObjects(2,"hunter_goblin",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3E3);b.addSpawnPoint(1,1500);b.addSpawnPoint(2,3E3);b.addObjects(0,"flaming_skull",2);b.addObjects(1,"imp",5);b.addObjects(1,
"wizard",3);b.addObjects(2,"flaming_skull",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1500);b.addSpawnPoint(1,1500);b.addSpawnPoint(2,1500);b.addObjects(0,"cyclops",1);b.addObjects(0,"goblin",5);b.addObjects(1,"demoblin",3);b.addObjects(1,"owlbear",1);b.addObjects(1,"demoblin",5);b.addObjects(2,"goblin",5);b.addObjects(2,"cyclops",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3500);b.addSpawnPoint(1,4E3);b.addSpawnPoint(2,5E3);b.addObjects(0,"wizard",5);b.addObjects(1,"imp",5);
b.addObjects(1,"owlbear",1);b.addObjects(2,"sandworm",3);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(1,1E3);b.addObjects(1,"superclops",1);b.bossWave=!0;b.bossName="Minotaur";a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,100);b.addSpawnPoint(1,100);b.addSpawnPoint(2,100);b.addObjects(0,"bat",15);b.addObjects(1,"dire_bat",15);b.addObjects(2,"bat",15);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1500);b.addSpawnPoint(1,1500);b.addSpawnPoint(2,1500);b.addObjects(0,"goblin",15);b.addObjects(1,
"hunter_goblin",15);b.addObjects(2,"goblin",15);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,2E3);b.addSpawnPoint(1,2E3);b.addSpawnPoint(2,2E3);b.addObjects(0,"demoblin",12);b.addObjects(1,"demoblin",12);b.addObjects(2,"demoblin",12);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,25E3);b.addSpawnPoint(1,25E3);b.addSpawnPoint(2,25E3);b.addObjects(0,"cyclops",2);b.addObjects(1,"cyclops",2);b.addObjects(2,"cyclops",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3E3);b.addSpawnPoint(1,
3E3);b.addSpawnPoint(2,3E3);b.addObjects(0,"imp",10);b.addObjects(1,"imp",10);b.addObjects(2,"imp",10);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,25E3);b.addSpawnPoint(1,25E3);b.addSpawnPoint(2,25E3);b.addObjects(0,"owlbear",2);b.addObjects(1,"owlbear",2);b.addObjects(2,"owlbear",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,12E3);b.addSpawnPoint(1,12E3);b.addSpawnPoint(2,12E3);b.addObjects(0,"wizard",4);b.addObjects(1,"wizard",4);b.addObjects(2,"wizard",4);a.waves.push(b);b=new c.SpawnWave;
b.addSpawnPoint(0,15E3);b.addSpawnPoint(1,2E4);b.addSpawnPoint(2,15E3);b.addObjects(0,"flaming_skull",5);b.addObjects(1,"huge_skull",3);b.addObjects(2,"flaming_skull",5);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,15E3);b.addSpawnPoint(1,15E3);b.addSpawnPoint(2,15E3);b.addObjects(0,"sandworm",5);b.addObjects(1,"sandworm",5);b.addObjects(2,"sandworm",5);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(1,1E3);b.addObjects(1,"dragon",1);b.bossWave=!0;b.bossName="Green Dragon";a.waves.push(b);
b=new c.SpawnWave;b.addSpawnPoint(0,3500);b.addSpawnPoint(1,3500);b.addSpawnPoint(2,3500);b.addObjects(0,"goblin",25);b.addObjects(1,"demoblin",25);b.addObjects(2,"hunter_goblin",25);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,7500);b.addSpawnPoint(1,5E3);b.addSpawnPoint(2,7500);b.addObjects(0,"sandworm",2);b.addObjects(0,"wizard",3);b.addObjects(1,"imp",10);b.addObjects(2,"sandworm",2);b.addObjects(2,"wizard",3);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,15E3);b.addSpawnPoint(1,
7500);b.addSpawnPoint(2,15E3);b.addObjects(0,"owlbear",3);b.addObjects(1,"flaming_skull",6);b.addObjects(2,"owlbear",3);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,2500);b.addSpawnPoint(1,15E3);b.addSpawnPoint(2,2500);b.addObjects(0,"demoblin",10);b.addObjects(0,"goblin",10);b.addObjects(1,"cyclops",1);b.addObjects(1,"owlbear",1);b.addObjects(1,"cyclops",1);b.addObjects(1,"owlbear",1);b.addObjects(2,"demoblin",10);b.addObjects(2,"goblin",10);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,
12500);b.addSpawnPoint(1,2E4);b.addSpawnPoint(2,12500);b.addObjects(0,"sandworm",5);b.addObjects(1,"huge_skull",1);b.addObjects(1,"owlbear",1);b.addObjects(1,"cyclops",1);b.addObjects(1,"huge_skull",1);b.addObjects(2,"sandworm",5);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,2E4);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,2E4);b.addObjects(0,"cyclops",1);b.addObjects(0,"flaming_skull",1);b.addObjects(1,"wizard",8);b.addObjects(2,"cyclops",1);b.addObjects(2,"flaming_skull",1);a.waves.push(b);
b=new c.SpawnWave;b.addSpawnPoint(0,4E3);b.addSpawnPoint(1,1E4);b.addSpawnPoint(2,4E3);b.addObjects(0,"demoblin",8);b.addObjects(1,"owlbear",2);b.addObjects(2,"demoblin",8);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,5E3);b.addSpawnPoint(1,7500);b.addSpawnPoint(2,5E3);b.addObjects(0,"sandworm",1);b.addObjects(0,"wizard",3);b.addObjects(1,"flaming_skull",4);b.addObjects(1,"huge_skull",1);b.addObjects(2,"sandworm",1);b.addObjects(2,"wizard",3);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,
2E3);b.addSpawnPoint(1,2500);b.addSpawnPoint(2,2E3);b.addObjects(0,"goblin",30);b.addObjects(1,"demoblin",25);b.addObjects(2,"hunter_goblin",30);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(1,1E3);b.addObjects(1,"beholder",1);b.bossWave=!0;b.bossName="Beholder";a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3E3);b.addSpawnPoint(1,3E3);b.addSpawnPoint(2,3E3);b.addObjects(0,"cyclops",2);b.addObjects(1,"owlbear",2);b.addObjects(2,"cyclops",2);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,
1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,1E3);b.addObjects(0,"wizard",3);b.addObjects(0,"flaming_skull",1);b.addObjects(1,"wizard",3);b.addObjects(1,"huge_skull",1);b.addObjects(2,"wizard",3);b.addObjects(2,"flaming_skull",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3E3);b.addSpawnPoint(1,3E3);b.addSpawnPoint(2,3E3);b.addObjects(0,"sandworm",3);b.addObjects(0,"owlbear",1);b.addObjects(1,"sandworm",3);b.addObjects(1,"huge_skull",1);b.addObjects(2,"sandworm",3);b.addObjects(2,"cyclops",
1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,200);b.addSpawnPoint(1,200);b.addSpawnPoint(2,200);b.addObjects(0,"dire_bat",20);b.addObjects(0,"wizard",2);b.addObjects(0,"cyclops",1);b.addObjects(1,"dire_bat",20);b.addObjects(1,"sandworm",2);b.addObjects(1,"owlbear",1);b.addObjects(2,"dire_bat",20);b.addObjects(2,"wizard",2);b.addObjects(2,"cyclops",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3E3);b.addSpawnPoint(1,3E3);b.addSpawnPoint(2,3E3);b.addObjects(0,"goblin",10);b.addObjects(0,
"cyclops",1);b.addObjects(0,"wizard",3);b.addObjects(1,"demoblin",10);b.addObjects(1,"huge_skull",1);b.addObjects(1,"sandworm",3);b.addObjects(2,"hunter_goblin",10);b.addObjects(2,"owlbear",1);b.addObjects(2,"flaming_skull",3);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,2500);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,2500);b.addObjects(0,"wizard",4);b.addObjects(1,"cube",1);b.addObjects(2,"wizard",4);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,1E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,
1E3);b.addObjects(0,"demoblin",5);b.addObjects(1,"superclops",1);b.addObjects(1,"demoblin",4);b.addObjects(2,"demoblin",5);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,3E4);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,3E4);b.addObjects(0,"sandworm",1);b.addObjects(0,"owlbear",1);b.addObjects(1,"dragon",1);b.addObjects(2,"sandworm",1);b.addObjects(2,"owlbear",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(0,15E3);b.addSpawnPoint(1,1E3);b.addSpawnPoint(2,15E3);b.addObjects(0,"wizard",1);b.addObjects(0,
"cyclops",1);b.addObjects(1,"beholder",1);b.addObjects(2,"wizard",1);b.addObjects(2,"cyclops",1);a.waves.push(b);b=new c.SpawnWave;b.addSpawnPoint(1,1E3);b.addObjects(1,"doppelganger",1);b.bossWave=!0;b.bossName="Doppelganger";a.waves.push(b)};c.Engine=function(){this.lastUpdate=0;this.canvases={};this.map=null;this.spawnPoints=[];this.objects={};this.objectIdSeed=0;this.playerObjectId=null;this.keyboard=new c.Keyboard;this.view=new c.Size(640,480);this.images=null;this.konamiEntered=this.debug=!1;
this.Clay=Clay=window.Clay={};Clay.gameKey="onslaughtarena";Clay.readyFunctions=[];Clay.options={};Clay.ready=function(a){Clay.readyFunctions.push(a)};var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https://":"http://")+"clay.io/api/api-src.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);this.clayLeaderboard={show:function(){console.log("Clay.io leaderboard not ready yet!")}};var g=this;Clay.ready(function(){g.loggedIn=Clay.Player.loggedIn;
g.clayLeaderboard=new Clay.Leaderboard({id:385,filters:["day","month","all"],tabs:[{title:"Cumulative",id:385,cumulative:!0,limit:20,filters:["day","month","all"]},{title:"My Best",id:385,self:!0,limit:10}]})});c.localData={};c.achievementsGranted={};this.running=!1;this.gateDirection="";this.gateState="down";this.pointerOptionsStart=this.maxPointerY=this.pointerYStart=this.pointerY=this.gatesY=this.gatesX=0;this.targetReticle={position:new c.Vector2,angle:0,moving:!1};this.enableClouds=this.enableFullscreen=
!1;this.cloudTimer=null;this.woundsToSpeed=10;this.introTimer=new c.Timer;this.introPhase=0;this.wonGame=this.introPhaseInit=!1;this.wonGamePhase=0;this.weaponPickup={type:null,state:"off",alpha:1,scale:1,position:new c.Vector2};this.coinPickup={amount:0,state:"off",alpha:1,position:new c.Vector2};this.touchMove=!1;this.canMute=!0;this.canFullscreen=!1;this.wasdMovesArrowsAttack=!0};d=c.Engine.prototype;d.cacheBust=function(){return"?cachebust=1.3.1"};d.resize=function(){var a=window.innerWidth,b=
window.innerHeight,c=document.getElementById("stage"),b=b-c.offsetTop;c.style.height=b+"px";this.enableFullscreen?(height=b-50,480>height&&(height=480),768<height&&(height=768),c=Math.round(1.333*height)):(c=640,height=480);var n=this.canvases.display;n.style.width=c+"px";n.style.height=height+"px";a=Math.max(a/2-c/2,0);b=Math.max(b/2-height/2,30);n.style.left=a+"px";n.style.top=b+"px";if(n=document.getElementById("tip"))n.style.top=b-30+"px",n.style.left=a+"px",n.style.width=c+"px"};d.run=function(){this.init();
this.lastUpdate=c.now();this.start()};d.start=function(){this.running||(this.running=!0,this.requestFrame())};d.stop=function(){this.running&&(this.running=!1)};var x=!1;d.togglePause=function(){this.getPlayerObject().hasState(c.Object.states.DYING)||(this.paused?(this.paused=!1,c.sound.setMuted(x),c.sound.play("unpause"),c.sound.play(this.currentMusic)):(this.paused=!0,this.initOptions(),x=c.sound.isMuted(),c.sound.play("pause"),c.sound.stop(this.currentMusic)))};d.addObject=function(a){this.objectIdSeed++;
var b="o"+this.objectIdSeed;a.id=b;this.objects[b]=a;return b};d.getBarColor=function(a,b){var c=100*(b/a);return 50<c?"rgb(98, 187, 70)":25<c?"rgb(246, 139, 31)":"rgb(238, 28, 36)"};d.spawnObject=function(a,b,g,n){for(var g=g||a.facing,b=c.makeObject(b,!0),d=a;null!==d.ownerId;)if(this.objects[d.ownerId])d=this.objects[d.ownerId];else break;!1!==n&&(b.ownerId=d.id,b.team=a.team);b.centerOn(a.boundingBox().center());b.setDirection(g);b.init();return this.addObject(b)};d.objectExists=function(a){return this.objects[a]};
d.getPlayerObject=function(){return this.objects[this.playerObjectId]};d.getObjectCountByType=function(a){var b=0,c;for(c in this.objects)this.objects[c].type===a&&b++;return b};d.isAlive=function(a){return this.objects[a]?(a=this.objects[a],a.alive&&a.wounds<a.hitPoints):!1};d.preloadComplete=function(){this.state="intro";this.logoAlpha=0;this.logoFade="in";this.logoFadeSpeed=0.5};d.init=function(){this.state="intro";this.canvases.display=c.makeCanvas("display",this.view.width,this.view.height);
this.canvases.buffer=c.makeCanvas("buffer",this.view.width,this.view.height,!0);this.canvases.waveText=c.makeCanvas("waveText",this.view.width,this.view.height,!0);this.resize();c.on("resize",this.resize,window,this);this.mouse=new c.Mouse(this.canvases.display);c.on("contextmenu",function(a){c.stopEvent(a)},document.body,this);c.on("blur",function(){"running"!=this.state||this.wonGame||(this.keyboard.keyStates={},this.paused||this.togglePause(),this.stop())},window,this);c.on("focus",function(){this.start()},
window,this);this.preloader=new c.ImageLoader;this.preloader.load({ui:"img/sheet_ui.png"+this.cacheBust()},this.preloadComplete,this);this.images=new c.ImageLoader;this.images.load({arena:"img/sheet_arena.png"+this.cacheBust(),characters:"img/sheet_characters.png"+this.cacheBust(),objects:"img/sheet_objects.png"+this.cacheBust(),beholder:"img/sheet_beholder.png"+this.cacheBust()},this.handleImagesLoaded,this);null===this.getData("high_score")&&this.putData("high_score",1E3);this.initSound()};d.initSound=
function(){c.sound.init(function(){var a=c.sound;a.create("normal_battle_music","sound/music/normal_battle",!0,20);a.create("final_battle_music","sound/music/final_battle",!0,20);a.create("victory","sound/music/victory",!0,20);a.create("move_pointer","sound/effects/move_pointer",!1,50);a.create("select_pointer","sound/effects/select_pointer",!1,50);a.create("pause","sound/effects/pause");a.create("unpause","sound/effects/unpause");a.create("code_entered","sound/effects/code_entered");a.create("gate_opens",
"sound/effects/gate_opens");a.create("gate_closes","sound/effects/gate_closes");a.create("spike_attack","sound/effects/spike_attacks");a.create("immunity","sound/effects/immunity",!1,25);a.create("coins","sound/effects/coins",!1,10);a.create("eat_food","sound/effects/eat_food",!1,30);a.create("pickup_weapon","sound/effects/pickup_weapon");a.create("weapon_wall","sound/effects/weapon_wall",!1,25);a.create("fire_attack","sound/effects/char_attacks_fire");a.create("hero_attacks","sound/effects/char_attacks");
a.create("hero_damage","sound/effects/char_damage_3");a.create("hero_dies","sound/effects/char_dies");a.create("bat_damage","sound/effects/bat_damage");a.create("bat_dies","sound/effects/bat_dies");a.create("goblin_attacks","sound/effects/goblin_attacks");a.create("goblin_damage","sound/effects/goblin_damage");a.create("goblin_dies","sound/effects/goblin_dies");a.create("demoblin_attacks","sound/effects/demoblin_attacks",!1,80);a.create("imp_damage","sound/effects/imp_damage",!1,30);a.create("imp_dies",
"sound/effects/imp_dies",!1,30);a.create("gel_damage","sound/effects/gel_damage",!1,20);a.create("gel_dies","sound/effects/gel_dies",!1,20);a.create("skull_damage","sound/effects/skull_damage",!1,25);a.create("skull_dies","sound/effects/skull_dies",!1,5);a.create("wizard_attacks","sound/effects/wizard_attacks",!1,25);a.create("wizard_disappear","sound/effects/wizard_disappear",!1,50);a.create("wizard_reappear","sound/effects/wizard_reappear",!1,50);a.create("sandworm_attacks","sound/effects/sandworm_attacks",
!1,75);a.create("sandworm_dies","sound/effects/sandworm_dies",!1,40);a.create("cyclops_attacks","sound/effects/cyclops_attacks");a.create("cyclops_damage","sound/effects/cyclops_damage");a.create("cyclops_dies","sound/effects/cyclops_dies");a.create("owlbear_alarm","sound/effects/owlbear_alarm",!1,20);a.create("owlbear_attacks","sound/effects/owlbear_attacks",!1,15);a.create("owlbear_damage","sound/effects/owlbear_damage",!1,40);a.create("owlbear_dies","sound/effects/owlbear_dies",!1,50);a.create("cube_attacks",
"sound/effects/cube_attacks");a.create("cube_damage","sound/effects/cube_damage");a.create("cube_dies","sound/effects/cube_dies");a.create("minotaur_attacks","sound/effects/minotaur_attacks");a.create("minotaur_damage","sound/effects/minotaur_damage");a.create("minotaur_dies","sound/effects/minotaur_dies");a.create("dragon_attacks","sound/effects/dragon_attacks");a.create("dragon_damage","sound/effects/dragon_damage");a.create("dragon_dies","sound/effects/dragon_dies");a.create("beholder_damage",
"sound/effects/beholder_damage",!1,50);a.create("beholder_dies","sound/effects/beholder_dies",!1,25);a.create("eyelet_damage","sound/effects/eyelet_damage",!1,25);a.create("eyelet_dies","sound/effects/eyelet_dies",!1,25);a.create("dopp_attacks","sound/effects/dopp_attacks",!1,50);a.create("dopp_damage","sound/effects/dopp_damage",!1,50);a.create("dopp_dies","sound/effects/dopp_dies")})};d.initGame=function(){this.enableClouds=this.konamiEntered=!1;this.closeGates();this.objects={};this.state="title";
this.initOptions();this.initMap();this.initSpawnPoints();this.initWaves();this.initPlayer();this.gameOverBg=null;this.statsIndex=this.statsIncrement=this.statsCount=this.scoreCount=this.gotNewHighScore=this.monstersAlive=0;this.statsTimer=null;this.wonGame=this.highScoreSaved=!1;this.wonGamePhase=0;this.showReticle=!1;this.hideReticleTimer=null;this.showTutorial=!1;this.tutorialIndex=0;this.tutorialY=-70;this.tutorialDirection="down";this.nextTutorialTimer=this.hideTutorialTimer=null;this.heroFiring=
!1;this.heroFiringDirection=null;this.woundsTo=0;this.gameStartTime=c.now()};d.initMap=function(){this.tileSize=new c.Size(32,32);this.map=[[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]};d.initSpawnPoints=function(){this.spawnPoints=[];this.spawnPoints.push(new c.SpawnPoint(3*this.tileSize.width,-2*this.tileSize.height,2*this.tileSize.width,2*this.tileSize.height));this.spawnPoints.push(new c.SpawnPoint(9*this.tileSize.width,
-2*this.tileSize.height,2*this.tileSize.width,2*this.tileSize.height));this.spawnPoints.push(new c.SpawnPoint(15*this.tileSize.width,-2*this.tileSize.height,2*this.tileSize.width,2*this.tileSize.height))};d.initSpawnWave=function(a){var b=0,c;for(c in a.points){var d=a.points[c],f=this.spawnPoints[d.spawnPointId];f.delay=d.delay;f.lastSpawnElapsed=f.delay;for(var r in d.objects){var i=d.objects[r];f.queueSpawn(i.type,i.count)}d=(f.queue.length-1)*f.delay;d>b&&(b=d)}this.waveTimer.start(b+a.nextWaveTime);
this.openGates()};d.initWaves=function(){this.waves=[];this.waveTimer=new c.Timer;this.waveTimer.start(1);this.currentWaveId=-1;this.waveText={string:"",size:20,state:"off",alpha:0};c.populateWaves(this)};d.initPlayer=function(){var a=c.makeObject("hero");a.weapons=[{type:"h_sword",count:null}];a.centerOn(c.Vector2.fromSize(this.view).scale(0.5));this.playerObjectId=this.addObject(a);this.touchMove&&(this.targetReticle.position=a.boundingBox().center())};d.handleImagesLoaded=function(){this.imagesLoaded=
!0};d.logoFadeOut=function(){this.logoFade="out"};d.updateLogo=function(a){var b=this.keyboard;if(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown())b.clearKeys(),this.mouse.clearButtons(),this.initGame();"in"===this.logoFade?(this.logoAlpha+=this.logoFadeSpeed/1E3*a,1<=this.logoAlpha&&(this.logoAlpha=1,this.logoFade="none",c.setTimeout(1E3,this.logoFadeOut,this))):"out"===this.logoFade&&(this.logoAlpha-=this.logoFadeSpeed/1E3*a,0>=this.logoAlpha&&(this.logoAlpha=0,this.logoFade="none",
this.initGame()))};d.updateIntroCinematic=function(a){this.introTimer.update(a);switch(this.introPhase){case 0:this.introPhaseInit||(this.introFadeAlpha=0,this.introPhaseInit=!0);this.introFadeAlpha+=0.0010*a;1<=this.introFadeAlpha&&(this.introFadeAlpha=1,this.introPhase++,this.introPhaseInit=!1);break;case 1:this.introPhaseInit||(this.introFadeAlpha=1,this.introPhaseInit=!0);this.introFadeAlpha-=5E-4*a;0>=this.introFadeAlpha&&(this.introFadeAlpha=0,this.introPhase++,this.introPhaseInit=!1);break;
case 2:this.introPhaseInit||(this.introTimer.start(1E3),this.introPhaseInit=!0);this.introTimer.expired()&&(this.introPhase++,this.introPhaseInit=!1);break;case 3:this.introPhaseInit||(this.openGates(),this.introPhaseInit=!0);"up"===this.gateState&&(this.introPhase++,this.introPhaseInit=!1);break;case 4:if(!this.introPhaseInit){var b=c.makeObject("hero");b.position.x=304;b.position.y=-64;b.collidable=!1;b.setDirection(new c.Vector2(0,1));this.introHero=b;this.introPhaseInit=!0}this.introHero.update(a);
this.moveObject(this.introHero,a);222<=this.introHero.position.y&&(this.introHero.centerOn(c.Vector2.fromSize(this.view).scale(0.5)),this.introHero.stopMoving(),this.introPhase++,this.introPhaseInit=!1);break;case 5:case 6:case 8:this.introPhaseInit||(this.introTimer.start(500),this.introPhaseInit=!0);this.introTimer.expired()&&(this.introPhase++,this.introPhaseInit=!1);break;case 7:this.introPhaseInit||(this.closeGates(),this.introPhaseInit=!0);"down"===this.gateState&&(this.introPhase++,this.introPhaseInit=
!1);break;case 9:this.introPhaseInit||(this.introTimer.start(1E3),this.introPhaseInit=!0),this.introHero.update(a),this.introTimer.expired()&&(this.currentMusic="normal_battle_music",c.sound.play(this.currentMusic),this.state="running")}};d.update=function(){var a=c.now(),b=a-this.lastUpdate;this.lastUpdate=a;this.lastElapsed=b;if(!0===this.imagesLoaded){switch(this.state){case "intro":this.updateLogo(b);this.render();break;case "title":this.handleInput();this.updateFauxGates(b);this.render();break;
case "credits":this.handleInput();this.render();break;case "intro_cinematic":this.handleInput();this.updateIntroCinematic(b);this.updateFauxGates(b);this.render();break;case "running":this.wonGame?this.updateWonGame(b):this.handleInput();this.paused||(this.updateWaves(b),this.updateSpawnPoints(b),this.updateClouds(b),this.updateObjects(b),this.updateFauxGates(b),this.updateWeaponPickup(b),this.updateCoinPickup(b));this.showTutorial&&this.updateTutorial(b);this.render();break;case "game_over":this.updateGameOver(b);
this.render();break;case "buy_now":this.handleInput(),this.render()}this.hideReticleTimer||(this.hideReticleTimer=new c.Timer);this.mouse.hasMoved&&(this.showReticle=!0,this.hideReticleTimer.start(5E3),this.nextTutorial(3));this.hideReticleTimer.update(b);this.hideReticleTimer.expired()&&(this.showReticle=!1);this.mouse.hasMoved=!1}this.requestFrame()};d.requestFrame=function(){if(this.running){var a=w,b=this,c=this.update;"string"==typeof c&&(c=b[c]);a(function(){c.apply(b,arguments)})}};d.updateWeaponPickup=
function(a){var b=this.weaponPickup;"on"===b.state&&(b.scale+=0.0045*a,b.alpha-=0.0025*a,0>=b.alpha&&(b.state="off"))};d.updateCoinPickup=function(a){var b=this.coinPickup;"on"===b.state&&(b.position.y-=0.05*a,b.alpha-=7E-4*a,0>=b.alpha&&(b.state="off"))};d.updateWonGame=function(a){var b=this.getPlayerObject();this.roseTimer&&this.roseTimer.update(a);switch(this.wonGamePhase){case 0:a=new c.Vector2(304,192);b.moveToward(a);b=b.position.clone().subtract(a).abs();5>=b.x&&5>=b.y&&this.wonGamePhase++;
break;case 1:b.setDirection(new c.Vector2(0,1));b.stopMoving();b.addState(c.Object.states.VICTORIOUS);this.roseTimer=new c.Timer;this.roseTimer.start(100);this.rosesThrown=0;this.wonGamePhase++;break;case 2:this.roseTimer.expired()&&(++this.rosesThrown,b=c.makeObject("rose"),2===c.randomRange(1,2)?(b.position.x=-32,b.position.y=c.randomRange(100,300),b.setDirection(new c.Vector2(1,0))):(b.position.x=682,b.position.y=c.randomRange(100,300),b.setDirection(new c.Vector2(-1,0))),this.addObject(b),this.roseTimer.reset()),
100<this.rosesThrown&&this.endGame()}};d.updateClouds=function(a){if(!0===this.enableClouds){null===this.cloudTimer&&(this.cloudTimer=new c.Timer,this.cloudTimer.start(2E3));this.cloudTimer.update(a);var a=0,b;for(b in this.objects){var g=this.objects[b];"cloud"===g.type&&(a++,g.position.x<-g.size.width&&g.die())}if(10>a&&this.cloudTimer.expired()){if(1<=c.randomRange(1,10)){b=c.randomRange(1,3);for(a=0;a<b;a++)g=c.makeObject("cloud"),g.position.x=640+c.randomRange(1,32),g.position.y=c.randomRange(-(g.size.height/
2),480+g.size.height/2),g.setDirection(new c.Vector2(-1,0)),this.addObject(g)}this.cloudTimer.reset()}}};d.updateSpawnPoints=function(a){if("up"===this.gateState){var b=!0,c;for(c in this.spawnPoints){1<=this.spawnPoints[c].queue.length&&(b=!1);var d=this.spawnPoints[c].update(a,0===this.monstersAlive);!1!==d&&this.addObject(d)}b&&!this.monstersAboveGates&&this.closeGates()}};d.spawnWaveExtras=function(a){switch(a){case 1:var b=this.getPlayerObject(),a=c.makeObject("item_weapon_knife");a.position=
b.position.clone();a.position.x-=96;a.position.y+=64;this.addObject(a);a=c.makeObject("item_weapon_spear");a.position=b.position.clone();a.position.x-=32;a.position.y+=64;this.addObject(a);a=c.makeObject("item_weapon_axe");a.position=b.position.clone();a.position.x+=32;a.position.y+=64;this.addObject(a);a=c.makeObject("item_weapon_fireball");a.position=b.position.clone();a.position.x+=96;a.position.y+=64;this.addObject(a);break;case 11:for(var g=[{x:192,y:224},{x:416,y:224}],b=g.length,a=0;a<b;++a){var d=
g[a],f=c.makeObject("spikes");f.position=new c.Vector2(d.x,d.y);this.addObject(f)}break;case 21:g=[{x:32,y:64},{x:32,y:352},{x:576,y:64},{x:576,y:352}];b=g.length;for(a=0;a<b;a++)d=g[a],f=c.makeObject("spike_sentry"),f.position=new c.Vector2(d.x,d.y),this.addObject(f);break;case 31:g=[{x:304,y:114},{x:304,y:304}];b=g.length;for(a=0;a<b;++a)d=g[a],f=c.makeObject("spikes"),f.position=new c.Vector2(d.x,d.y),this.addObject(f);break;case 41:this.enableClouds=!0;break;case 50:for(b in this.objects)a=this.objects[b],
"trap"===a.role&&a.die()}};d.updateWaves=function(a){if(!this.wonGame){this.waveTimer.update(a);var b=!0,g;for(g in this.spawnPoints)0<this.spawnPoints[g].queue.length&&(b=!1);if(!0===b&&0===this.monstersAlive){if(this.currentWaveId===this.waves.length-1){this.wonGame=!0;c.sound.stop("normal_battle_music");c.sound.stop("final_battle_music");c.sound.play("victory");return}b=!1;switch(this.currentWaveId+1){case 1:b="wave1";break;case 5:b="wave5"}b&&!c.achievementsGranted[b]&&(c.achievementsGranted[b]=
!0,(new Clay.Achievement({id:b})).award());this.currentWaveId++;b=this.currentWaveId+1;if(this.continuing||this.waveHack){for(g=this.waveHack?1:2;g<=b;++g)this.spawnWaveExtras(g);this.waveHack=!1}else this.spawnWaveExtras(b);g="Wave "+b;var d="normal_battle_music";1<b&&(this.putData("checkpoint_wave",this.currentWaveId),this.putData("checkpoint_hero",JSON.stringify(this.getPlayerObject())));this.waves[this.currentWaveId].bossWave&&(g="Boss: "+this.waves[this.currentWaveId].bossName+"!",d="final_battle_music");
this.currentMusic!==d&&(c.sound.stop(this.currentMusic),this.currentMusic=d,c.sound.play(this.currentMusic));this.initSpawnWave(this.waves[this.currentWaveId]);this.waveText.string=g;this.waveText.alpha=0;this.waveText.size=1;this.waveText.state="init";b=this.canvases.waveText.getContext("2d");g=this.waveText.string;b.clearRect(0,0,640,480);b.save();b.font="Bold 40px MedievalSharp";b.lineWidth=3;b.textBaseline="top";b.strokeStyle="rgb(0, 0, 0)";b.fillStyle="rgb(230, 103, 8)";b.strokeText(g,0,0);b.fillText(g,
0,0);g=b.measureText(g);this.waveText.width=g.width;b.restore();this.continuing=!1}switch(this.waveText.state){case "init":this.waveText.alpha+=0.0020*a;1<=this.waveText.alpha&&(this.waveText.alpha=1,this.waveText.timer=new c.Timer,this.waveText.timer.start(250),this.waveText.state="display");break;case "display":this.waveText.timer.update(a);this.waveText.timer.expired()&&(this.waveText.state="hide");break;case "hide":this.waveText.alpha-=0.0015*a,this.waveText.size+=0.02*a,0>=this.waveText.alpha&&
(this.waveText.alpha=0,this.waveText.state="off")}}};d.updateGameOver=function(a){this.gameOverAlpha||(this.gameOverReady=!1,this.gameOverAlpha=0);this.gameOverAlpha+=Number(2E-4*a)||0;0.75<=this.gameOverAlpha&&(this.gameOverReady=!0,this.gameOverAlpha=0.75);this.gameOverReady&&(this.statsTimer||(this.statsTimer=new c.Timer,this.statsIndex=this.statsCount=0,this.statsTimer.start(50),this.statsIncrement=1),this.statsTimer.update(a),this.statsTimer.expired()&&(this.statsTimer.reset(),this.statsCount+=
this.statsIncrement));if(4<=this.statsIndex&&!this.highScoreSaved){this.highScoreSaved=!0;var a=Number(this.getData("high_score")),b=this.getTotalScore(),g=this;this.clayLeaderboard.post({score:b},function(){g.showLeaderboard(!0)});b>a&&(this.putData("high_score",b),c.sound.play("victory"),this.gotNewHighScore=!0)}};d.showLeaderboard=function(a){var a="undefined"===typeof a?!1:a,b=[];b.push("Share your score: ");b.push("<a href='#' id='facebook-button'>Facebook</a>");b.push(" or <a href='#' id='twitter-button'>Twitter</a>");
var c=this;a?this.clayLeaderboard.show({html:b.join("")},function(){document.getElementById("facebook-button").onclick=function(){c.postSocial("facebook")};document.getElementById("twitter-button").onclick=function(){c.postSocial("twitter")}}):this.clayLeaderboard.show()};d.postSocial=function(a){var b=this;(new Clay.Screenshot({prompt:!1,id:"display"})).save(function(c){"facebook"==a?(new Clay.Facebook).post({message:"I just scored "+b.getTotalScore()+" in Onslaught! Arena - (screenshot: "+c.url+
")",link:"http://onslaughtarena.clay.io"}):"twitter"==a&&(new Clay.Twitter).post({message:"I just scored "+b.getTotalScore()+" in Onslaught! Arena - (sreenshot: "+c.url+")! Play me: http://onslaughtarena.clay.io"})})};d.openGates=function(){"up"!==this.gateState&&(this.gateDirection="up",c.sound.play("gate_opens"))};d.closeGates=function(){"down"!==this.gateState&&(this.gateDirection="down",c.sound.play("gate_closes"))};d.updateFauxGates=function(a){"down"===this.gateDirection&&(this.gatesX=0,this.gatesY+=
0.2*a,0<=this.gatesY&&(this.gatesY=this.gatesX=0,this.gateDirection="",this.gateState="down"));"up"===this.gateDirection&&(this.gatesX=c.randomRange(-1,1),this.gatesY-=0.05*a,-54>=this.gatesY&&(this.gatesX=0,this.gatesY=-54,this.gateDirection="",this.gateState="up"))};d.updateTutorial=function(a){"down"===this.tutorialDirection&&(this.tutorialY+=0.1*a,0<=this.tutorialY&&(this.tutorialY=0,this.tutorialDirection=null,4<=this.tutorialIndex&&this.hideTutorialTimer.start(5E3)));"up"===this.tutorialDirection&&
(this.tutorialY-=0.1*a,-70>this.tutorialY&&(this.tutorialY=-70,this.tutorialDirection="down",this.tutorialIndex+=1,4<this.tutorialIndex&&(this.showTutorial=!1)));this.hideTutorialTimer||(this.hideTutorialTimer=new c.Timer);this.nextTutorialTimer||(this.nextTutorialTimer=new c.Timer,this.nextTutorialTimer.start(1E4));this.hideTutorialTimer.update(a);this.nextTutorialTimer.update(a);this.hideTutorialTimer.expired()&&(this.tutorialDirection="up");this.nextTutorialTimer.expired()&&(this.nextTutorial(this.tutorialIndex+
1),this.nextTutorialTimer.reset())};d.nextTutorial=function(a){this.showTutorial&&null===this.tutorialDirection&&this.tutorialIndex===a-1&&(this.tutorialDirection="up")};d.getTilesByRect=function(a){for(var b=[],g=new c.Vector2(a.left,a.top),d=new c.Vector2(a.width,a.height),a=g.clone().scale(1/this.tileSize.width).floor(),g=g.clone().add(d).scale(1/this.tileSize.width).floor(),d=a.x;d<=g.x;d++)for(var f=a.y;f<=g.y;f++)b.push({x:d,y:f});return b};d.checkTileCollision=function(a){for(var a=this.getTilesByRect(a.boundingBox()),
b=0,c=a.length;b<c;b++){var d=a[b];if(this.map[d.y]&&0===this.map[d.y][d.x])return d}return!1};d.moveObject=function(a,b){if(!a.badass&&a.hasState(c.Object.states.HURTING))return!1;var g=a.speed;a.hasState(c.Object.states.SLOWED)&&(g*=0.2);var d=g/1E3*b,g=[];if(0!==a.direction.x&&(a.position.x+=a.direction.x*d,a.collidable)){16>a.position.x&&(a.position.x=16);624<a.position.x+a.size.width&&(a.position.x=624-a.size.width);var f=this.checkTileCollision(a);!1!==f&&(g.push("x"),a.position.x=a.position.x+
a.size.width/2<f.x*this.tileSize.width+this.tileSize.width/2?f.x*this.tileSize.width-a.size.width:f.x*this.tileSize.width+this.tileSize.width)}0!==a.direction.y&&(a.position.y+=a.direction.y*d,a.collidable&&(400<a.position.y+a.size.height&&(a.position.y=400-a.size.height),f=this.checkTileCollision(a),!1!==f&&(g.push("y"),a.position.y=a.position.y+a.size.height/2<f.y*this.tileSize.height+this.tileSize.height/2?f.y*this.tileSize.height-a.size.height:f.y*this.tileSize.height+this.tileSize.height)));
if(a.collidable){d=0;if("down"===this.gateState||"monster"===a.role||"hero"===a.role)d=64;0>a.direction.y&&a.position.y<d&&(a.position.y=d,g.push("y"));0<g.length&&a.wallCollide(g)}};d.dropObject=function(a,b){var g=c.makeObject(b);g.position=a.position.clone();g.position.y-=1;this.isSpecialLoot(b)&&(g.position=new c.Vector2(304,226));this.addObject(g);if(this.isSpecialLoot(b)){var d=c.makeObject("pickup_arrow");d.position=g.position.clone();d.position.x=320-d.size.width/2;d.position.y-=d.size.height+
10;this.addObject(d)}};d.isSpecialLoot=function(a){return"item_weapon_fire_sword"===a||"item_gold_chest"===a};d.spawnLoot=function(a){if(!(44>a.position.y)){for(var b=a.lootTable,g=b.length,d=[],f=0;f<g;f++)for(var r=b[f],i=0;i<r.weight;i++)d.push(r.type);b=c.randomRange(0,d.length-1);d=d[b];if(null!==d){b=this.getPlayerObject();"item_food"===d&&0===b.wounds&&(d="item_chest");if("WEAPON_DROP"===d)switch(c.randomRange(1,4)){case 1:d="item_weapon_knife";break;case 2:d="item_weapon_spear";break;case 3:d=
"item_weapon_fireball";break;case 4:d="item_weapon_axe"}0<=d.indexOf("item_weapon")&&b.hasWeapon("h_fire_sword")&&(d="item_chest");this.dropObject(a,d)}}};d.updateObjects=function(a){var b=0,g=0,d;for(d in this.objects){var f=this.objects[d];if(f.isDead()){if("hero"===f.role){this.endGame();return}f.execute("onDelete",[this]);delete this.objects[f.id]}else{if("monster"===f.role||"pickup_arrow"===f.type)b++,64>=f.position.y&&g++;switch(f.update(a,this)){case "shoot":this.objectAttack(f)}f.isMoving()&&
!f.hasState(c.Object.states.STUNNED)&&this.moveObject(f,a);if(!("fluff"===f.role||"powerup_food"===f.role||f.hasState(c.Object.states.DYING)||f.hasState(c.Object.states.INVISIBLE))){for(var r in this.objects){var i=this.objects[r];if(!i.isDead()&&!(i.team===f.team||"fluff"===i.role||i.hasState(c.Object.states.DYING)||i.hasState(c.Object.states.INVISIBLE))&&f.boundingBox().reduce(5).intersects(i.boundingBox().reduce(5))){if("hero"==f.role)if("powerup_food"==i.role){i.die();f.wounds-=i.healAmount;0>
f.wounds&&(f.wounds=0);f.meatEaten++;c.sound.play("eat_food");for(var t=0;5>t;++t){var e=c.makeObject("mini_heart");e.position.x=f.position.x+t*(f.size.width/5);e.position.y=f.position.y+f.size.height-c.randomRange(0,f.size.height);this.addObject(e)}}else if("powerup_coin"==i.role){if(i.die(),f.gold+=i.coinAmount,c.sound.play("coins"),e=this.coinPickup,e.amount=i.coinAmount,e.y=0,e.alpha=1,e.position=i.position.clone(),e.state="on",this.isSpecialLoot(i.type))for(t in this.objects)"pickup_arrow"===
this.objects[t].type&&this.objects[t].die()}else if("powerup_weapon"==i.role&&(i.die(),f.addWeapon(i.wepType,i.wepCount),c.sound.play("pickup_weapon"),e=this.weaponPickup,e.type=i.type,e.scale=1,e.alpha=0.9,e.position=i.position.clone(),e.state="on",this.isSpecialLoot(i.type)))for(t in this.objects)"pickup_arrow"===this.objects[t].type&&this.objects[t].die();null!==f.team&&(null!==i.team&&f.team!==i.team)&&(this.dealDamage(i,f),this.dealDamage(f,i))}}this.isBadassWeapon(f)&&(void 0===f.glow&&(f.glow=
{alpha:0,increment:0.2,timer:new c.Timer},f.glow.timer.start(50)),f.glow.timer.update(a),f.glow.timer.expired()&&(f.glow.timer.reset(),f.glow.alpha+=f.glow.increment,0.8<=f.glow.alpha&&(f.glow.alpha=0.8,f.glow.increment=-0.2),0.2>=f.glow.alpha&&(f.glow.alpha=0.2,f.glow.increment=0.2)))}}}this.monstersAlive=b;this.monstersAboveGates=0<g;b=this.getPlayerObject();this.woundsTo=this.woundsTo<b.wounds?this.woundsTo+this.woundsToSpeed/1E3*a:this.woundsTo>b.wounds?this.woundsTo-this.woundsToSpeed/1E3*a:
b.wounds;g=this.getTotalScore();d=Math.abs(this.scoreCount-g);d=c.clamp(d,1E3,1E4);a=Math.floor(d/1E3*a);this.scoreCount<g?(this.scoreCount+=a,this.scoreCount>g&&(this.scoreCount=g)):this.scoreCount>g&&(this.scoreCount-=a,this.scoreCount<g&&(this.scoreCount=g));1>=Math.abs(b.wounds-this.woundsTo)&&(this.woundsTo=b.wounds)};d.dealDamage=function(a,b){if("monster"===a.role&&"projectile"===b.role)return!1;a.execute("onObjectCollide",[b,this]);if("projectile"==a.role&&"trap"==b.role||"trap"==a.role&&
"projectile"==b.role)return!1;var g=b.execute("onThreat",[a,this]);if(b.hasState(c.Object.states.INVINCIBLE)||Infinity===b.hitPoints||!0===g)return"projectile"===a.role&&Infinity!==a.hitPoints&&(("magic"===b.damageType||"physical"===b.damageType)&&"physical"===a.damageType?(a.reverseDirection(),a.deflect(),c.sound.play("immunity")):a.die()),!1;if(Infinity!==a.hitPoints&&"projectile"===a.role&&"projectile"===b.role&&"physical"===a.damageType&&"physical"===b.damageType)return!1===a.piercing&&(a.reverseDirection(),
a.deflect()),!1===b.piercing&&(b.reverseDirection(),b.deflect()),!1;a.execute("onDamage",[b,this]);g=a;if(null!==g.ownerId){var d=this.objects[g.ownerId];d&&(g=d)}"projectile"===a.role&&g.shotsLanded++;b.wound(a.damage)?(g.gold+=b.worth,g.kills++,b.execute("onKilled",[a,this]),0<b.lootTable.length&&this.spawnLoot(b),"projectile"===a.role&&(!1===a.piercing&&Infinity!==a.hitPoints)&&a.die()):(0<a.damage&&"hero"===b.role&&b.addState(c.Object.states.INVINCIBLE,2500),"projectile"===a.role&&Infinity!==
a.hitPoints&&a.die())};d.updateTargetReticle=function(){this.targetReticle.moving=!1;var a=new c.Vector2(this.mouse.mouseX,this.mouse.mouseY),b=new c.Rect(32,64,576,320),g=this.targetReticle.position;if(g.x!==a.x&&g.y!==a.y){this.targetReticle.moving=!0;var d=g.clone().subtract(a.clone()).abs(),d=c.clamp(2*(d.x+d.y),1,100);this.targetReticle.angle+=d/1E3*this.lastElapsed;this.targetReticle.angle>2*Math.PI&&(this.targetReticle.angle=0)}g.x=a.x<b.left?b.left:a.x>b.left+b.width?b.left+b.width:a.x;g.y=
a.y<b.top?b.top:a.y>b.top+b.height?b.top+b.height:a.y};d.grabContinueInfo=function(){var a=this;this.getData("checkpoint_wave",function(b){b=b.data;null!==b&&"undefined"!==typeof b&&(a.currentWaveId=b-1,a.getData("checkpoint_hero",function(b){b=b.data;if(null!==b){var c=a.getPlayerObject();c.load(b);c.totalDamageTaken+=c.wounds;c.wounds=0}a.continuing=!0;a.showTutorial=!1;a.state="intro_cinematic"}))},!0)};d.handleInput=function(){var a,b,g,d,f,r,i,e,h=this.keyboard;e=c.Keyboard.Keys;var l=c.Mouse.Buttons,
k=new c.Vector2(this.mouse.mouseX,this.mouse.mouseY),m;this.leaderboardHover=this.achievementsHover=this.loginHover=a=!1;if("running"==this.state){if(this.keyboard.isKeyPressed(e.ESCAPE)&&this.showTutorial){this.tutorialIndex=4;this.nextTutorial(5);return}if(this.keyboard.isKeyPressed(e.P)||this.keyboard.isKeyPressed(e.ESCAPE)){this.togglePause();this.keyboard.clearKeys();return}this.paused&&(a=!0);this.canMute&&this.keyboard.isKeyPressed(77)&&c.sound.toggleMuted();this.canFullscreen&&this.keyboard.isKeyPressed(70)&&
this.toggleFullscreen();this.keyboard.isKeyPressed(75)&&(this.wasdMovesArrowsAttack=!this.wasdMovesArrowsAttack);if(!c.isDemo()){if(this.keyboard.historyMatch(c.Keyboard.meatboyCode)){var j=this.getPlayerObject();j.isMeatboy=!0;j.initMeatBoy()}this.keyboard.historyMatch(c.Keyboard.godModeCode)&&(this.keyboard.clearHistory(),j=this.getPlayerObject(),j.cheater=!0,j.hasState(c.Object.states.INVINCIBLE)?j.removeState(c.Object.states.INVINCIBLE):j.addState(c.Object.states.INVINCIBLE),c.sound.play("code_entered"));
this.keyboard.historyMatch(c.Keyboard.allWeaponsCode)&&(this.keyboard.clearHistory(),j=this.getPlayerObject(),j.cheater=!0,j.weapons=[{type:"h_fire_sword",count:null}],c.sound.play("code_entered"));this.keyboard.historyMatch(c.Keyboard.awesmCode)&&(this.keyboard.clearHistory(),j=this.getPlayerObject(),j.cheater=!0,j.weapons=[{type:"h_fire_knife",count:null}],c.sound.play("code_entered"));this.keyboard.historyMatch(c.Keyboard.bombCode)&&(this.keyboard.clearHistory(),j=this.getPlayerObject(),j.cheater=
!0,j.weapons=[{type:"h_firebomb",count:null}],c.sound.play("code_entered"));this.keyboard.historyMatch(c.Keyboard.debugCode)&&(this.keyboard.clearHistory(),this.debug=!this.debug,c.sound.play("code_entered"));this.keyboard.historyMatch(c.Keyboard.resetCode)&&(this.keyboard.clearHistory(),this.clearData("checkpoint_wave"),this.clearData("checkpoint_hero"),this.putData("high_score",1E3),c.sound.play("code_entered"));this.keyboard.historyMatch(c.Keyboard.cyclopsCode)&&(j=this.getPlayerObject(),j.cheater||
(c.sound.play("code_entered"),this.keyboard.clearHistory(),j.cheater=!0,j.hitPoints*=2,j.size=new c.Size(64,64),j.spriteY=224,j.weapons=[{type:"e_boulder",count:null}],j.wounds*=2))}if(this.paused&&(j=this.pointerYStart-22,this.verifyQuit?(270<=k.x&&462>=k.x&&(k.y>j&&k.y<j+23)&&(this.mouse.hasMoved&&0!==this.pointerY&&(m=0),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0)),270<=k.x&&462>=k.x&&(k.y>j+24&&k.y<j+24+36)&&(this.mouse.hasMoved&&1!==this.pointerY&&(m=1),this.mouse.isButtonDown(l.LEFT)&&
(this.keyboard.keyStates[e.SPACE]=!0))):(270<=k.x&&376>=k.x&&(k.y>j&&k.y<j+23)&&(this.mouse.hasMoved&&0!==this.pointerY&&(m=0),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0)),270<=k.x&&376>=k.x&&(k.y>j+24&&k.y<j+24+36)&&(this.mouse.hasMoved&&1!==this.pointerY&&(m=1),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0))),h.isKeyPressed(e.ENTER)||h.isKeyPressed(e.SPACE)))switch(h.clearKey(e.ENTER),h.clearKey(e.SPACE),this.mouse.clearButtons(),this.pointerY){case 0:this.togglePause();
break;case 1:c.sound.play("select_pointer"),this.verifyQuit?(this.verifyQuit=!1,this.togglePause(),j=this.getPlayerObject(),j.wound(100)):(this.pointerY=0,this.verifyQuit=!0)}}if("title"===this.state){a=!0;!this.konamiEntered&&this.keyboard.historyMatch(c.Keyboard.konamiCode)&&(c.sound.play("code_entered"),this.konamiEntered=!0,j=this.getPlayerObject(),j.cheater=!0,j.hitPoints*=3);j=this.pointerYStart-22;if((c.isDemo()||this.canContinue())&&230<=k.x&&400>=k.x&&k.y>=j&&k.y<j+20)this.mouse.hasMoved&&
0!==this.pointerY&&(m=0),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0);j+=24;230<=k.x&&400>=k.x&&(k.y>=j&&k.y<j+20)&&(this.mouse.hasMoved&&1!==this.pointerY&&(m=1),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0));j+=24;230<=k.x&&400>=k.x&&(k.y>=j&&k.y<j+20)&&(this.mouse.hasMoved&&2!==this.pointerY&&(m=2),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0));j=444;if(220<=k.x&&320>=k.x&&(k.y>=j&&k.y<j+18)&&(this.leaderboardHover=!0,
this.mouse.isButtonDown(l.LEFT)&&!this.leaderboardShowFlag)){this.leaderboardShowFlag=!0;this.showLeaderboard();var p=this;setTimeout(function(){p.leaderboardShowFlag=!1},1E3)}320<=k.x&&420>=k.x&&(k.y>=j&&k.y<j+20)&&(this.achievementsHover=!0,this.mouse.isButtonDown(l.LEFT)&&!this.achievementsShowFlag&&(this.achievementsShowFlag=!0,Clay.Achievement.showAll(),p=this,setTimeout(function(){p.achievementsShowFlag=!1},1E3)));j+=20;!this.loggedIn&&(230<=k.x&&400>=k.x&&k.y>=j&&k.y<j+18)&&(this.loginHover=
!0,this.mouse.isButtonDown(l.LEFT)&&!this.loginShowFlag&&(this.loginShowFlag=!0,Clay.Player.login(),p=this,setTimeout(function(){p.loginShowFlag=!1},1E3)));if(h.isKeyPressed(e.ENTER)||h.isKeyPressed(e.SPACE))switch(c.sound.play("select_pointer"),h.clearKey(e.ENTER),h.clearKey(e.SPACE),this.mouse.clearButtons(),this.pointerY){case 0:c.isDemo()?location.href="https://chrome.google.com/extensions/detail/khodnfbkbanejphecblcofbghjdgfaih":this.grabContinueInfo();break;case 1:this.continuing=!1;this.showTutorial=
!this.touchMove;this.state="intro_cinematic";break;case 2:this.state="credits"}}if("buy_now"==this.state&&(a=!0,j=this.pointerYStart-22,270<=k.x&&376>=k.x&&(k.y>j&&k.y<j+23)&&(this.mouse.hasMoved&&0!==this.pointerY&&(m=0),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0)),270<=k.x&&376>=k.x&&(k.y>j+24&&k.y<j+24+36)&&(this.mouse.hasMoved&&1!==this.pointerY&&(m=1),this.mouse.isButtonDown(l.LEFT)&&(this.keyboard.keyStates[e.SPACE]=!0)),h.isKeyPressed(e.ENTER)||h.isKeyPressed(e.SPACE)))switch(h.clearKey(e.ENTER),
h.clearKey(e.SPACE),this.mouse.clearButtons(),c.sound.play("select_pointer"),this.pointerY){case 0:location.href="https://chrome.google.com/extensions/detail/khodnfbkbanejphecblcofbghjdgfaih";break;case 1:c.sound.stop("victory"),this.initGame()}if("credits"===this.state&&(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown()))h.clearKeys(),this.mouse.clearButtons(),this.state="title";if("intro_cinematic"===this.state&&(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown()))h.clearKeys(),
this.mouse.clearButtons(),this.state="running",j=this.getPlayerObject(),this.woundsTo=j.wounds,this.currentMusic="normal_battle_music",c.sound.play(this.currentMusic);if(a){if(this.keyboard.isKeyPressed(e.W)||this.keyboard.isKeyPressed(e.UP))this.keyboard.keyStates[e.W]=!1,this.keyboard.keyStates[e.UP]=!1,this.pointerY--,this.pointerY<this.pointerOptionsStart&&(this.pointerY=this.maxPointerY),c.sound.play("move_pointer");if(this.keyboard.isKeyPressed(e.S)||this.keyboard.isKeyPressed(e.DOWN))this.keyboard.keyStates[e.S]=
!1,this.keyboard.keyStates[e.DOWN]=!1,this.pointerY++,this.pointerY>this.maxPointerY&&(this.pointerY=this.pointerOptionsStart),c.sound.play("move_pointer");this.keyboard.storeKeyStates();void 0!==m&&(c.sound.play("move_pointer"),this.pointerY=m)}if("running"===this.state)if(j=this.getPlayerObject(),this.paused||j.hasState(c.Object.states.DYING))this.keyboard.storeKeyStates();else{if(this.touchMove){if(this.targetReticle.angle+=2*Math.PI/5E3*this.lastElapsed,this.targetReticle.angle>2*Math.PI&&(this.targetReticle.angle=
0),this.mouse.wasButtonClicked(l.LEFT)||this.mouse.isButtonDown(l.LEFT))m=new c.Rect(48,80,544,288),a=this.targetReticle.position,a.x=k.x<m.left?m.left:k.x>m.left+m.width?m.left+m.width:k.x,a.y=k.y<m.top?m.top:k.y>m.top+m.height?m.top+m.height:k.y}else this.updateTargetReticle();var q=new c.Vector2;m=new c.Vector2;this.touchMove?(h=this.getNearestHostile(j),null!==h&&(m=h.boundingBox().center().subtract(j.boundingBox().center()).normalize()),q=this.targetReticle.position.clone().subtract(j.boundingBox().center()).normalize(),
3>this.targetReticle.position.clone().subtract(j.boundingBox().center()).magnitude()&&q.zero()):(this.wasdMovesArrowsAttack?(a=e.W,b=e.A,g=e.S,d=e.D,f=e.UP,r=e.DOWN,i=e.LEFT,e=e.RIGHT):(a=e.UP,g=e.DOWN,b=e.LEFT,d=e.RIGHT,f=e.W,i=e.A,r=e.S,e=e.D),h.isKeyDown(a)&&(q.y=-1,this.nextTutorial(1)),h.isKeyDown(b)&&(q.x=-1,this.nextTutorial(1)),h.isKeyDown(g)&&(q.y=1,this.nextTutorial(1)),h.isKeyDown(d)&&(q.x=1,this.nextTutorial(1)),h.isKeyDown(f)&&(m.y=-1,this.nextTutorial(2)),h.isKeyDown(r)&&(m.y=1,this.nextTutorial(2)),
h.isKeyDown(i)&&(m.x=-1,this.nextTutorial(2)),h.isKeyDown(e)&&(m.x=1,this.nextTutorial(2)));j.stopMoving();(0!==q.x||0!==q.y)&&j.setDirection(q);this.mouse.wasButtonClicked(l.LEFT)&&(this.showTutorial&&k.y<=70+this.tutorialY?(this.tutorialIndex=4,this.nextTutorial(5),this.mouse.clearButtons()):604<=k.x&&636>=k.x&&442<=k.y&&475>=k.y?this.canFullscreen?(this.toggleFullscreen(),this.mouse.clearButtons()):this.togglePause():this.canMute&&(570<=k.x&&602>=k.x&&442<=k.y&&484>=k.y)&&(c.sound.toggleMuted(),
this.mouse.clearButtons()));this.mouse.isButtonDown(l.LEFT)&&!this.touchMove?(l=this.targetReticle.position.clone().subtract(j.boundingBox().center()).normalize(),this.objectAttack(j,l),this.heroFiring=!0,this.heroFiringDirection=l,this.nextTutorial(4),this.showReticle=!0):0!==m.x||0!==m.y?(this.objectAttack(j,m),this.heroFiring=!0,this.heroFiringDirection=m):(this.heroFiring=!1,this.heroFiringDirection=null);this.keyboard.storeKeyStates();this.mouse.storeButtonStates()}};d.getNearestHostile=function(a){var b=
null,g=Infinity,d;for(d in this.objects){var f=this.objects[d];if(f.team!=a.team&&("monster"==f.role||"projectile"==f.role)&&Infinity!==f.hitPoints&&this.isAlive(f.id)&&!f.hasState(c.Object.states.INVINCIBLE)&&!f.hasState(c.Object.states.INVISIBLE)){var e=a.boundingBox().center().subtract(f.boundingBox().center()).magnitude();e<g&&(b=f,g=e)}}return null===b?null:b};d.objectAttack=function(a,b){b||(b=a.facing);var g=a.fireWeapon();if(!1!==g){var d=c.objectTypes[g];switch(g){case "e_minotaur_trident":for(var f=
b.heading(),e=-0.5;0.5>=e;e+=0.5)this.spawnObject(a,g,c.Vector2.fromHeading(f+e));a.shotsFired+=3;break;case "h_knife":case "h_fire_knife":f=b.heading();this.spawnObject(a,g,c.Vector2.fromHeading(f-0.1));this.spawnObject(a,g,c.Vector2.fromHeading(f+0.1));a.shotsFired+=2;break;case "e_fireball_green":for(e=-0.25;0.25>=e;e+=0.25)f=b.heading(),f+=e+c.randomRange(-1,1)/10,this.spawnObject(a,g,c.Vector2.fromHeading(f));a.shotsFired+=3;break;case "h_fireball":var f=b.heading(),i=c.Vector2.fromHeading(f),
e=this.spawnObject(a,g,i.clone()),e=this.objects[e];e.position.add(c.Vector2.fromHeading(f-Math.PI/2).scale(16));e.position.add(i.clone().scale(16));e=this.spawnObject(a,g,i.clone());e=this.objects[e];e.position.add(i.clone().scale(32));e=this.spawnObject(a,g,i.clone());e=this.objects[e];e.position.add(c.Vector2.fromHeading(f+Math.PI/2).scale(16));e.position.add(i.clone().scale(16));a.shotsFired+=3;break;case "h_firebomb":for(var h=this.targetReticle.position.clone(),i=2*Math.PI,l=i/20,f=0;f<i;f+=
l)e=c.makeObject("h_fireball"),e.position.x=h.x-16,e.position.y=h.y-16,e.setDirection(c.Vector2.fromHeading(f)),e.ownerId=a.id,e.team=a.team,this.addObject(e),a.shotsFired+=1;break;case "e_ring_fire":i=2*Math.PI;l=i/10;for(f=e=l/2;f<i+e;f+=l)this.spawnObject(a,g,c.Vector2.fromHeading(f));break;case "e_ring_fire_dopp":i=2*Math.PI;l=i/10;for(f=0;f<i;f+=l)this.spawnObject(a,g,c.Vector2.fromHeading(f));break;case "e_bouncing_boulder":i=2*Math.PI;l=i/8;for(f=0;f<i;f+=l)this.spawnObject(a,g,c.Vector2.fromHeading(f));
break;default:this.spawnObject(a,g,b),a.shotsFired++}a.shotsPerWeapon[g]||(a.shotsPerWeapon[g]=0);a.shotsPerWeapon[g]++;g=null;d.soundAttacks?g=d.soundAttacks:a.soundAttacks&&(g=a.soundAttacks);null!==g&&c.sound.play(g)}};d.render=function(){var a=this.canvases.display.getContext("2d");switch(this.state){case "intro":this.drawLogo(a);break;case "title":this.drawTitle(a);this.drawPointer(a);this.drawTitlePointerOptions(a);break;case "credits":this.drawTitle(a);this.drawCredits(a);break;case "intro_cinematic":this.drawIntroCinematic(a);
break;case "running":this.drawFloor(a);this.wonGame||this.drawTargetReticle(a);this.drawObjects(a);this.drawFauxGates(a);this.drawWalls(a);this.drawWeaponPickup(a);this.drawCoinPickup(a);this.drawWaveText(a);this.drawUI(a);this.paused&&(this.drawPaused(a),this.drawPointer(a),this.drawPausedPointerOptions(a));this.showTutorial&&this.drawTutorial(a);break;case "game_over":this.drawGameOver(a);break;case "buy_now":this.drawBuyNow(a),this.drawPointer(a)}!0===this.debug&&this.drawDebugInfo(a)};d.drawWeaponPickup=
function(a){var b=this.weaponPickup;if("on"===b.state){var g=c.makeObject(b.type);a.save();a.translate(b.position.x+g.size.width/2,b.position.y+g.size.height/2);a.globalAlpha=b.alpha;a.drawImage(this.images.getImage("objects"),128,192,48,48,-22*b.scale,-20*b.scale,48*b.scale,48*b.scale);a.drawImage(this.images.getImage(g.spriteSheet),g.spriteX,g.spriteY+1,g.size.width-1,g.size.height-1,-(g.size.width/2*b.scale),-(g.size.height/2*b.scale),g.size.width*b.scale,g.size.height*b.scale);a.restore()}};d.drawCoinPickup=
function(a){var b=this.coinPickup;if("on"===b.state){var c=this.getCoinFontData(b.amount),d="+"+b.amount;a.save();a.fillStyle=c.fillStyle;a.font="Bold "+c.size+"px MedievalSharp";a.lineWidth=2;a.strokeStyle="rgb(0, 0, 0)";a.textAlign="center";a.textBaseline="top";a.translate(b.position.x,b.position.y);a.globalAlpha=b.alpha;a.strokeText(d,0,0);a.fillText(d,0,0);a.restore()}};d.getCoinFontData=function(a){return 100==a?{fillStyle:"rgb(255, 203, 5)",size:24}:500==a?{fillStyle:"rgb(255, 244, 96)",size:36}:
{fillStyle:"rgb(255, 248, 160)",size:50}};d.drawWaveText=function(a){if("off"!=this.waveText.state){var b=parseInt(this.waveText.size),c=this.waveText.width*b,b=40*b,d=320-c/2,f=240-b/2;a.save();a.globalAlpha=this.waveText.alpha;a.drawImage(this.canvases.waveText,0,0,this.waveText.width,40,d,f,c,b);a.restore()}};d.drawGameOver=function(a){this.goAlphaStep?(this.goAlpha+=this.goAlphaStep,0>=this.goAlpha&&(this.goAlpha=0,this.goAlphaStep=0.025),1<=this.goAlpha&&(this.goAlpha=1,this.goAlphaStep=-0.025)):
(this.goAlphaStep=-0.025,this.goAlpha=1);this.gameOverBg||(this.drawUI(a),this.gameOverBg=a.getImageData(0,0,this.view.width,this.view.height));a.putImageData(this.gameOverBg,0,0);a.save();a.globalAlpha=this.gameOverAlpha;a.fillStyle=this.wonGame?"rgb(0, 0, 0)":"rgb(215, 25, 32)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();if(!0===this.gameOverReady){if(this.keyboard.isAnyKeyPressed()||this.mouse.isAnyButtonDown())if(this.keyboard.clearKeys(),this.mouse.clearButtons(),this.statsIndex+=
1,5<=this.statsIndex){c.isDemo()?(this.state="buy_now",this.initOptions()):(c.sound.stop("victory"),this.initGame());return}a.drawImage(this.preloader.getImage("ui"),0,2322,564,404,38,38,564,404);this.wonGame?a.drawImage(this.preloader.getImage("ui"),564,2444,256,50,192,70,256,50):this.gotNewHighScore?a.drawImage(this.preloader.getImage("ui"),564,2374,404,50,119,70,404,50):a.drawImage(this.preloader.getImage("ui"),564,2324,218,50,211,70,218,50);this.drawObjectStats(this.getPlayerObject(),a);4<=this.statsIndex&&
a.drawImage(this.preloader.getImage("ui"),564,2424,334,20,153,404,334,20)}};d.drawBuyNow=function(a){a.save();a.globalAlpha=0.7;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),370,0,564,404,38,38,564,404);a.restore();var b=this.pointerYStart-22,c;c=0==this.pointerY?260:0;a.drawImage(this.preloader.getImage("ui"),c,2122,200,40,270,b,200,40);c=1==this.pointerY?260:0;a.drawImage(this.preloader.getImage("ui"),c,2182,200,40,270,b+24,200,40)};d.drawObjectStats=
function(a,b){b.save();b.font="Bold 40px MedievalSharp";var c,d=0,f=0,e=this.currentWaveId;this.wonGame&&(e+=1);var i=0;0===this.statsIndex?(i=this.statsCount,d=e,c=199,f=10):i=e;b.fillStyle="rgb(199, 234, 251)";b.fillText(i+" x 1000",350,182);e=0;1===this.statsIndex?(e=this.statsCount,d=a.gold,f=c=10):1<this.statsIndex&&(e=a.gold);b.fillStyle="rgb(255, 245, 121)";b.fillText(e,350,235);e=0;2===this.statsIndex?(e=this.statsCount,d=a.totalDamageTaken,c=299,f=5):2<this.statsIndex&&(e=a.totalDamageTaken);
b.fillStyle="rgb(237, 28, 36)";b.fillText("-"+e+" x 10",350,290);e="";i=this.getTotalScore();3===this.statsIndex?(e=this.statsCount,d=i):3<this.statsIndex&&(e=i);b.fillStyle="rgb(250, 166, 26)";b.fillText(e,350,349);this.statsCount>=d&&(this.statsCount=0,this.statsIncrement=c,this.statsIndex+=1,this.statsTimer.start(f));b.restore()};d.getTotalScore=function(){var a=this.getPlayerObject(),b=this.currentWaveId;this.wonGame&&(b+=1);b=1E3*b+a.gold;b-=10*a.totalDamageTaken;!0===a.cheater&&(b/=2);0>b&&
(b=0);return b};d.drawLogo=function(a){a.save();a.fillStyle="rgb(0, 0, 0)";a.fillRect(0,0,this.view.width,this.view.height);a.restore();0<this.logoAlpha&&(a.save(),a.globalAlpha=this.logoAlpha,a.drawImage(this.preloader.getImage("ui"),0,0,370,430,160,0,370,430),a.restore())};d.drawFloor=function(a){var b=this.getArenaOffset();a.drawImage(this.images.getImage("arena"),b+32,480,576,386,32,0,576,386)};d.drawWalls=function(a){var b=this.getArenaOffset();a.drawImage(this.images.getImage("arena"),b,0,640,
480,0,0,this.view.width,this.view.height)};d.getArenaOffset=function(){return 640*Math.floor((0<=this.currentWaveId?this.currentWaveId:0)/10)};d.drawPaused=function(a){a.save();a.globalAlpha=0.7;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),0,1718,564,404,38,38,564,404);var b=this.getPlayerObject();a.font="Bold 36px MedievalSharp";a.textAlign="left";a.fillStyle="rgb(237, 28, 36)";a.fillText(b.kills,390,164);a.fillStyle="rgb(145, 102, 0)";
a.fillText(b.meatEaten,390,216);a.fillStyle="rgb(199, 234, 251)";a.fillText(b.shotsFired,390,270);a.fillStyle="rgb(250, 166, 26)";a.fillText(this.getAccuracy(b)+"%",390,324);a.restore()};d.getAccuracy=function(a){return 0===a.shotsFired?0:Math.round(100*(a.shotsLanded/a.shotsFired))};d.drawTutorial=function(a){if(!this.paused){a.save();a.globalAlpha=0.7;a.fillRect(0,this.tutorialY,this.view.width,70);a.globalAlpha=1;a.font="Bold 22px MedievalSharp";a.textAlign="center";var b=["MOVE with the WASD keys.",
"ATTACK with the ARROW keys.","Or use the MOUSE to AIM with the target reticle.","ATTACK by HOLDING DOWN the LEFT MOUSE BUTTON.","KILL MONSTERS and COLLECT GOLD to raise your score!"];a.fillStyle="rgb(0, 0, 0)";a.fillText(b[this.tutorialIndex],322,this.tutorialY+36);a.fillStyle="rgb(230, 230, 230)";a.fillText(b[this.tutorialIndex],320,this.tutorialY+34);a.font="20px MedievalSharp";a.fillStyle="rgb(0, 0, 0)";a.fillText("Press here or ESC to skip",322,this.tutorialY+62);a.fillStyle="rgb(118, 151, 183)";
a.fillText("Press here or ESC to skip",320,this.tutorialY+60);a.restore()}};d.getObjectDrawOrder=function(){var a=[],b;for(b in this.objects){var c=this.objects[b];a.push({id:c.id,drawIndex:c.drawIndex,y:c.position.y+c.size.height})}a.sort(function(a,b){return a.drawIndex===b.drawIndex?a.y-b.y:a.drawIndex-b.drawIndex});return a};d.drawObject=function(a,b){var d="hero"===b.role&&this.heroFiring?b.getSpriteXY(this.heroFiringDirection):b.getSpriteXY();if(!(0>=b.alpha||b.hasState(c.Object.states.INVISIBLE))){a.save();
a.translate(b.position.x+b.size.width/2,b.position.y+b.size.height/2);0!==b.angle&&a.rotate(b.angle*Math.PI/180);1!==b.alpha&&(a.globalAlpha=b.alpha);"powerup_weapon"===b.role&&a.drawImage(this.images.getImage("objects"),128,192,48,48,-22,-20,48,48);a.drawImage(this.images.getImage(b.spriteSheet),d.x,d.y+1,b.size.width-1,b.size.height-1,-(b.size.width/2),-(b.size.height/2),b.size.width,b.size.height);b.spriteYOverlay&&(a.save(),a.globalAlpha=1-b.wounds/b.hitPoints+0.3,a.drawImage(this.images.getImage(b.spriteSheet),
d.x,b.spriteYOverlay+1,b.size.width-1,b.size.height-1,-(b.size.width/2),-(b.size.height/2),b.size.width,b.size.height),a.restore());"monster"===b.role&&(b.badass&&b.hasState(c.Object.states.HURTING))&&this.drawImageOverlay(a,this.images.getImage(b.spriteSheet),d.x,d.y+1,b.size.width-1,b.size.height-1,-(b.size.width/2),-(b.size.height/2),b.size.width,b.size.height,"rgba(186, 51, 35, 0.6)");this.isBadassWeapon(b)&&b.glow&&this.drawImageOverlay(a,this.images.getImage(b.spriteSheet),d.x,d.y+1,b.size.width-
1,b.size.height-1,-(b.size.width/2),-(b.size.height/2),b.size.width,b.size.height,"rgba(255, 247, 143, "+b.glow.alpha+")");if(this.debug&&"monster"===b.role||b.badass&&!b.hasState(c.Object.states.DYING))d=b.size.width-2,d-=Math.round(d*b.wounds/b.hitPoints),a.fillStyle="rgb(241, 241, 242)",a.fillRect(-(b.size.width/2),b.size.height/2,b.size.width,8),a.fillStyle="rgb(0, 0, 0)",a.fillRect(-(b.size.width/2)+1,b.size.height/2+1,b.size.width-2,6),a.fillStyle=this.getBarColor(b.hitPoints,b.hitPoints-b.wounds),
a.fillRect(-(b.size.width/2)+1,b.size.height/2+1,d,6);a.restore()}};d.isBadassWeapon=function(a){return"projectile"===a.role&&Infinity===a.hitPoints&&1===a.team&&"e_fireball"!=a.type&&"e_static_blue_fire"!=a.type&&"e_static_green_fire"!=a.type};d.drawObjects=function(a){var b=this.getObjectDrawOrder(),c;for(c in b)this.drawObject(a,this.objects[b[c].id])};d.drawTargetReticle=function(a){this.showReticle&&(a.save(),a.globalAlpha=0.75,a.translate(this.targetReticle.position.x,this.targetReticle.position.y),
a.rotate(this.targetReticle.angle),a.drawImage(this.images.getImage("objects"),256,192,64,64,-32,-32,64,64),a.restore())};d.drawImageOverlay=function(a,b,c,d,e,h,i,l,p,q,k){var m=this.canvases.buffer.getContext("2d");m.save();m.clearRect(0,0,640,480);m.drawImage(b,c,d,e,h,0,0,p,q);m.globalCompositeOperation="source-in";m.fillStyle=k;m.fillRect(0,0,p,q);m.restore();a.drawImage(this.canvases.buffer,0,0,p,q,i,l,p,q)};d.drawUI=function(a){var b=this.getPlayerObject(),d=b.getWeaponInfo(),e=c.objectTypes[d.type],
d=d.count?d.count:"";a.drawImage(this.images.getImage("objects"),e.spriteX,e.spriteY,32,32,4,412,32,32);a.drawImage(this.images.getImage("objects"),32,32,32,32,4,442,32,32);a.save();a.textAlign="left";a.font="Bold 32px MedievalSharp";a.globalAlpha=0.75;a.fillStyle="rgb(0, 0, 0)";a.fillText(d,48,444);a.fillText(this.scoreCount,48,474);a.globalAlpha=1;a.fillStyle="rgb(241, 241, 242)";a.fillText(d,46,440);a.fillText(this.scoreCount,46,472);a.restore();if(1<b.hitPoints){var d=280-Math.round(280*b.wounds/
b.hitPoints),f=280-Math.round(280*this.woundsTo/b.hitPoints);this.woundsTo<b.wounds?(e=d,d=f):e=f;a.save();a.fillStyle="rgb(241, 241, 242)";a.fillRect(210,430,282,28);a.fillRect(492,432,2,24);a.fillStyle="rgb(0, 0, 0)";a.fillRect(212,432,280,24);a.fillStyle=this.getBarColor(b.hitPoints,b.hitPoints-b.wounds);a.globalAlpha=0.4;a.fillRect(212,432,d,24);a.fillRect(212,432,e,24);a.fillRect(212,437,e,14);a.fillRect(212,442,e,4);a.restore();b=100*((b.hitPoints-b.wounds)/b.hitPoints);e=352;50<b?e=224:25<
b&&(e=288);a.drawImage(this.images.getImage("objects"),e,64,42,42,180,424,42,42)}this.canMute&&a.drawImage(this.preloader.getImage("ui"),c.sound.isMuted()?692:660,910,32,32,570,442,32,32);this.canFullscreen?(e=this.enableFullscreen?596:564,a.drawImage(this.preloader.getImage("ui"),e,910,32,32,604,442,32,32)):a.drawImage(this.preloader.getImage("ui"),628,910,32,32,604,442,32,32)};d.drawTitle=function(a){a.drawImage(this.preloader.getImage("ui"),0,430,640,480,0,0,640,480);var b="High Score: "+this.getData("high_score");
a.save();a.font="Bold 24px MedievalSharp";a.textAlign="center";a.fillStyle="rgb(0, 0, 0)";a.fillText(b,322,444);a.fillStyle="rgb(230, 230, 230)";a.fillText(b,320,442);a.restore();b="High Scores  ";a.save();a.font="Bold 16px MedievalSharp";a.textAlign="right";a.fillStyle="rgb(0, 0, 0)";a.fillText(b,322,462);a.fillStyle=this.leaderboardHover?"rgb(180, 180, 180)":"rgb(230, 230, 230)";a.fillText(b,320,460);a.restore();b="  Achievements";a.save();a.font="Bold 16px MedievalSharp";a.textAlign="left";a.fillStyle=
"rgb(0, 0, 0)";a.fillText(b,322,462);a.fillStyle=this.achievementsHover?"rgb(180, 180, 180)":"rgb(230, 230, 230)";a.fillText(b,320,460);a.restore();b=this.loggedIn?"Logged In as "+Clay.Player.data.username:"Login with Clay.io";a.save();a.font="Bold 12px MedievalSharp";a.textAlign="center";a.fillStyle="rgb(0, 0, 0)";a.fillText(b,322,476);a.fillStyle=this.loginHover?"rgb(180, 180, 180)":"rgb(230, 230, 230)";a.fillText(b,320,474);a.restore();b="v1.3.1";c.isDemo()&&(b+=" demo");a.save();a.font="Bold 14px Monospace";
a.textAlign="right";a.fillStyle="rgb(0, 0, 0)";a.fillText(b,638,480);a.fillStyle="rgb(230, 230, 230)";a.fillText(b,636,478);a.restore();a.save();a.font="Bold 14px Monospace";a.fillStyle="rgb(0, 0, 0)";a.fillText("Lost Decade Games",6,462);a.fillStyle="rgb(230, 230, 230)";a.fillText("Lost Decade Games",4,460);a.restore();a.save();a.font="Bold 14px Monospace";a.fillStyle="rgb(0, 0, 0)";a.fillText("\u00a9 2010",6,478);a.fillStyle="rgb(230, 230, 230)";a.fillText("\u00a9 2010",4,476);a.restore()};d.drawPointer=
function(a){var b=this.pointerYStart+24*this.pointerY-24;a.save();a.drawImage(this.images.getImage("objects"),320,192,36,26,228,b,36,26);a.restore()};d.canContinue=function(){if(this.canContinueVar){var a=this.canContinueVar;return a}if(!this.grabbingContinueVar){this.grabbingContinueVar=!0;var b=this;Clay.ready(function(){b.getData("checkpoint_wave",function(a){b.canContinueVar=Boolean(a.data)});Clay.Player.onUserReady(function(){b.canContinue(!0)})})}a=this.getData("checkpoint_wave");return Boolean(a)};
d.drawTitlePointerOptions=function(a){var b=this.pointerYStart-22,d;c.isDemo()?(d=0==this.pointerY?638:430,a.drawImage(this.preloader.getImage("ui"),800,d,128,26,270,b,128,26)):(d=this.canContinue()?0==this.pointerY?638:430:534,a.drawImage(this.preloader.getImage("ui"),640,d,116,20,270,b,116,20));d=1==this.pointerY?664:456;a.drawImage(this.preloader.getImage("ui"),640,d,132,26,270,b+24,132,26);d=2==this.pointerY?690:482;a.drawImage(this.preloader.getImage("ui"),640,d,90,22,270,b+48,90,22)};d.drawPausedPointerOptions=
function(a){var b=this.pointerYStart-22,c;this.verifyQuit?(c=0==this.pointerY?1932:1860,a.drawImage(this.preloader.getImage("ui"),564,c,158,26,270,b,158,26)):(c=0==this.pointerY?1788:1718,a.drawImage(this.preloader.getImage("ui"),564,c,106,26,270,b,106,26));this.verifyQuit?(c=1==this.pointerY?1966:1894,a.drawImage(this.preloader.getImage("ui"),564,c,192,32,270,b+24,196,32)):(c=1==this.pointerY?1822:1752,a.drawImage(this.preloader.getImage("ui"),564,c,70,36,270,b+24,70,36))};d.initOptions=function(){switch(this.state){case "title":this.pointerYStart=
314;this.pointerOptionsStart=c.isDemo()||this.canContinue()?this.pointerY=0:this.pointerY=1;this.maxPointerY=2;break;case "running":this.pointerYStart=378;this.pointerY=0;this.maxPointerY=1;this.pointerOptionsStart=0;this.verifyQuit=!1;break;case "buy_now":this.pointerYStart=378,this.pointerY=0,this.maxPointerY=1,this.pointerOptionsStart=0}};d.drawCredits=function(a){a.save();a.globalAlpha=0.7;a.fillRect(0,0,this.view.width,this.view.height);a.globalAlpha=1;a.drawImage(this.preloader.getImage("ui"),
0,1314,564,404,38,38,564,404);a.restore()};d.drawIntroCinematic=function(a){switch(this.introPhase){case 0:this.introFadeOutBg||(this.introFadeOutBg=a.getImageData(0,0,this.view.width,this.view.height),this.introFadeAlpha=0);a.fillStyle="rgb(0, 0, 0)";a.fillRect(0,0,640,480);a.save();a.putImageData(this.introFadeOutBg,0,0);a.restore();0<this.introFadeAlpha&&(a.save(),a.globalAlpha=this.introFadeAlpha,a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,640,480),a.restore());break;case 1:this.drawFloor(a);this.drawFauxGates(a);
this.drawWalls(a);0<this.introFadeAlpha&&(a.save(),a.globalAlpha=this.introFadeAlpha,a.fillStyle="rgb(0, 0, 0)",a.fillRect(0,0,640,480),a.restore());break;case 2:case 3:this.drawFloor(a);this.drawFauxGates(a);this.drawWalls(a);break;case 4:case 5:case 9:this.drawFloor(a);this.introHero&&this.drawObject(a,this.introHero);this.drawFauxGates(a);this.drawWalls(a);break;case 6:case 7:case 8:this.drawFloor(a),a.drawImage(this.images.getImage("characters"),640,0,32,32,304,224,32,32),this.drawFauxGates(a),
this.drawWalls(a)}};d.drawFauxGates=function(a){for(var b=0;3>b;b++){var c=0,d=192;0<b&&(c=320,d=1==b?288:352);a.drawImage(this.images.getImage("objects"),c,d,64,64,this.gatesX+96+192*b,this.gatesY,64,64)}};d.drawDebugInfo=function(a){a.save();a.fillStyle="rgba(0, 0, 0, 0.3)";a.fillRect(0,0,this.view.width,30);a.restore();a.save();a.fillStyle="rgb(241, 241, 242)";a.font="Bold 20px Monospace";a.fillText("Elapsed: "+this.lastElapsed,10,20);a.textAlign="right";a.fillText(Math.round(1E3/this.lastElapsed)+
" FPS",630,20);a.restore()};d.getData=function(a,b,d){if(b)Clay.isReady&&Clay.Player.loggedIn&&(d||!c.localData[a])?Clay.Player.fetchUserData(a,function(d){c.localData[a]={value:d.data,times:0,timeout:null};b(d)}):c.localData[a]?b({data:c.localData[a].value,usingVar:!0}):(b({data:window.localStorage.getItem(a),usingLocalStorage:!0}),c.localData[a]=window.localStorage.getItem(a));else if(window.localStorage&&window.localStorage.getItem)return window.localStorage.getItem(a)};d.putData=function(a,b){window.localStorage&&
window.localStorage.setItem&&window.localStorage.setItem(a,b);if(!Clay.isReady)return!1;if(c.localData[a]&&c.localData[a].timeout){clearTimeout(c.localData[a].timeout);var d=c.localData[d]+1}else d=0;c.localData[a]={value:b,times:d,timeout:setTimeout(function(){Clay.Player.saveUserData(a,b);c.localData[a].timeout=null},3E3)}};d.clearData=function(a){window.localStorage&&window.localStorage.removeItem&&window.localStorage.removeItem(a)};d.endGame=function(){this.gameOverReady=!1;this.gameOverAlpha=
0;this.updateGameOver();this.state="game_over";this.timePlayed=c.now()-this.gameStartTime};d.toggleFullscreen=function(){c.sound.play("select_pointer");this.enableFullscreen=!this.enableFullscreen;this.putData("fullscreen",this.enableFullscreen?1:0);this.resize()};c.Object=function(){this.id="";this.ownerId=null;this.position=new c.Vector2;this.size=new c.Size(32,32);this.direction=new c.Vector2;this.facing=new c.Vector2(0,1);this.speed=100;this.team=null;this.damage=this.hitPoints=1;this.spriteSheet=
"";this.spriteY=this.spriteX=0;this.animated=this.spriteAlign=!1;this.animFrameIndex=0;this.animNumFrames=2;this.animDelay=200;this.spawnFrameIndex=this.animElapsed=0;this.spawnFrameCount=2;this.angle=this.spawnFramesY=this.spawnFramesX=0;this.rotateSpeed=400;this.rotate=!1;this.ttlElapsed=this.ttl=this.worth=0;this.alphaMod=this.alpha=1;this.gibletSize="small";this.cooldown=!1;this.cooldownElapsed=0;this.autoFire=!1;this.soundDies=this.soundDamage=this.soundAttacks=null;this.alive=!0;this.states=
[];this.addState(c.Object.states.IDLE);this.currentWeaponIndex=0;this.bounce=this.collidable=!0;this.piercing=!1;this.achievementId=null;this.deathsForAchievement=Infinity;this.ignoreLogDeath=!1;this.soundDies=this.soundDamage=null;this.damageType="physical";this.drawIndex=1;this.moveChangeElapsed=0;this.moveChangeDelay=500;this.wounds=0;this.weapons=[];this.shotsLanded=this.shotsFired=this.totalDamageTaken=this.timesWounded=this.kills=this.gold=0;this.shotsPerWeapon={};this.meatEaten=0;this.cheater=
!1;this.phase=0;this.phaseInit=!1;this.lootTable=[];this.killSwitch=!1};c.Object.states={IDLE:0,MOVING:1,ATTACKING:2,HURTING:3,DYING:4,INVINCIBLE:5,INVISIBLE:6,SPAWNING:7,DESPAWNING:8,STUNNED:9,VICTORIOUS:10};d=c.Object.prototype;d.load=function(a){a=JSON.parse(a);this.wounds=a.wounds;this.weapons=a.weapons;this.currentWeaponIndex=a.currentWeaponIndex;this.gold=a.gold;this.kills=a.kills;this.timesWounded=a.timesWounded;this.totalDamageTaken=a.totalDamageTaken;this.shotsFired=a.shotsFired;this.shotsLanded=
a.shotsLanded;this.shotsPerWeapon=a.shotsPerWeapon;this.meatEaten=a.meatEaten;this.cheater=a.cheater};d.setPhase=function(a){this.phase=a;this.phaseInit=!1};d.nextPhase=function(){this.setPhase(this.phase+1)};d.updateStates=function(a){for(var b in this.states){var c=this.states[b];c.timer.update(a);c.timer.expired()&&this.removeStateById(b)}};d.hasState=function(a){for(var b in this.states)if(this.states[b].type===a)return!0;return!1};d.addState=function(a,b){if(this.hasState(a))return!1;var d=new c.Timer;
d.start(b);this.states.push({type:a,timer:d});switch(a){case c.Object.states.SLOWED:this.oldAnimDelay=this.animDelay,this.animDelay*=2}};d.removeStateById=function(a){switch(this.states[a].type){case c.Object.states.INVINCIBLE:this.alpha=1;this.alphaMod=-1;break;case c.Object.states.SLOWED:this.animDelay=this.oldAnimDelay}delete this.states[a]};d.removeState=function(a){for(var b in this.states)this.states[b].type===a&&this.removeStateById(b)};d.init=function(){this.execute("onInit");this.rotate&&
(this.angle=c.randomRange(0,359));this.animated&&(this.animElapsed=c.randomRange(0,this.animDelay))};d.die=function(){this.alive=!1;("monster"==this.role||"projectile"==this.role)&&!this.ignoreLogDeath&&this.logDeath()};d.logDeath=function(){var a=0,b=this.type+"_killed",d=this;null!==this.achievementId&&c.Engine.prototype.getData(b,function(e){a=(e.data?e.data:0)+1;c.Engine.prototype.putData(b,a);d.achievementId&&(a>=d.deathsForAchievement&&!c.achievementsGranted[d.achievementId])&&(c.achievementsGranted[d.achievementId]=
!0,(new Clay.Achievement({id:d.achievementId})).award())});"monster"==this.role&&(b="overall_killed",c.Engine.prototype.getData(b,function(d){a=(d.data?d.data:0)+1;c.Engine.prototype.putData(b,a);achievementId="killenemies";1E4<=a&&!c.achievementsGranted[achievementId]&&(c.achievementsGranted[achievementId]=!0,(new Clay.Achievement({id:achievementId})).award())}))};d.isDead=function(){return!this.alive};d.update=function(a,b){if(!1===this.killSwitch&&null!==this.ownerId&&!b.isAlive(this.ownerId)){switch(this.role){case "projectile":case "trap":this.ttl=
1E3;this.ttlElapsed=0;break;case "monster":this.wound(this.hitPoints)}this.killSwitch=!0}this.updateStates(a);this.deathTimer&&this.deathTimer.update(a);this.hasState(c.Object.states.DYING)&&this.deathTimer.expired()&&(this.deathFrameIndex++,this.deathTimer.reset(),2<this.deathFrameIndex&&(this.deathFrameIndex=2,this.ttl=750));this.hasState(c.Object.states.INVINCIBLE)&&(this.alpha+=0.01*a*this.alphaMod,1<=this.alpha&&(this.alpha=1,this.alphaMod=-1),0>=this.alpha&&(this.alpha=0,this.alphaMod=1));if(!this.hasState(c.Object.states.STUNNED)){this.animated&&
(this.animElapsed+=a,this.animElapsed>=this.animDelay&&(this.animElapsed=0,this.animFrameIndex++,this.animFrameIndex>this.animNumFrames-1&&(this.animFrameIndex=0),this.hasState(c.Object.states.SPAWNING)&&(this.spawnFrameIndex++,this.spawnFrameIndex>this.spawnFrameCount&&this.removeState(c.Object.states.SPAWNING)),this.hasState(c.Object.states.DESPAWNING)&&(this.spawnFrameIndex--,0>this.spawnFrameIndex&&this.removeState(c.Object.states.DESPAWNING))));this.spriteAlign&&(this.angle=this.facing.angle());
this.rotate&&(this.angle+=this.rotateSpeed/1E3*a);0<this.ttl&&(this.ttlElapsed+=a,1E3>=this.ttl-this.ttlElapsed&&(this.alpha-=0.0010*a),this.ttlElapsed>=this.ttl&&this.die());if(!0===this.cooldown){this.cooldownElapsed+=a;var d=this.getWeaponInfo();this.cooldownElapsed>=c.objectTypes[d.type].cooldown&&(this.cooldown=!1,this.cooldownElapsed=0)}this.phaseTimer&&this.phaseTimer.update(a);if(!this.hasState(c.Object.states.DYING))return this.execute("onUpdate",arguments)}};d.getSpriteXY=function(a){if(this.animated)switch(this.role){case "hero":case "monster":if(this.hasState(c.Object.states.DYING))return new c.Vector2((17+
this.deathFrameIndex)*this.size.width,this.spriteY);if(this.hasState(c.Object.states.SPAWNING)||this.hasState(c.Object.states.DESPAWNING))return new c.Vector2(this.spawnFramesX+this.spawnFrameIndex*this.size.width,this.spawnFramesY);if(this.hasState(c.Object.states.HURTING)&&32>=this.size.width)return new c.Vector2(16*this.size.width,this.spriteY);if(this.hasState(c.Object.states.VICTORIOUS))return new c.Vector2(20*this.size.width,this.spriteY);a=a?a:this.facing.clone();a=c.directions.fromVector(a);
return new c.Vector2((2*a+this.animFrameIndex)*this.size.width,this.spriteY);default:return this.hasState(c.Object.states.SPAWNING)||this.hasState(c.Object.states.DESPAWNING)?new c.Vector2(this.spawnFramesX+this.spawnFrameIndex*this.size.width,this.spawnFramesY):new c.Vector2(this.spriteX+this.animFrameIndex*this.size.width,this.spriteY)}else return new c.Vector2(this.spriteX,this.spriteY)};d.boundingBox=function(){var a=new c.Rect(this.position.x,this.position.y,this.size.width-1,this.size.height-
1);"projectile"===this.role&&a.reduce(1);"e_spit_pool"===this.type&&(a.y+=this.size.height/4,a.x+=5,a.height-=this.size.height/2,a.width-=10);"gas_cloud"===this.type&&(a.y+=32,a.x+=32,a.height-=32,a.width-=32);return a};d.centerOn=function(a){this.position=a.subtract(c.Vector2.fromSize(this.size).scale(0.5))};d.wound=function(a){if(1>a||this.hasState(c.Object.states.DYING)||this.isDead())return!1;this.removeState(c.Object.states.STUNNED);this.wounds+=a;this.totalDamageTaken+=a;this.timesWounded++;
("monster"===this.role||"hero"===this.role)&&this.addState(c.Object.states.HURTING,300);if(this.wounds>=this.hitPoints)return this.wounds=this.hitPoints,"monster"===this.role||"hero"===this.role?(this.addState(c.Object.states.DYING),this.deathFrameIndex=0,this.deathTimer=new c.Timer,this.deathTimer.start(200)):this.die(),"hero"===this.role&&c.sound.stopAll(),this.soundDies&&c.sound.play(this.soundDies),!0;this.soundDamage&&c.sound.play(this.soundDamage);return!1};d.wallCollide=function(a){if("hero"!==
this.role){if(this.bounce){var b=this.direction.clone(),d;for(d in a)b[a[d]]*=-1;this.setDirection(b);"projectile"===this.role&&c.sound.play("weapon_wall")}else"physical"===this.damageType?this.deflect():this.die();this.execute("onWallCollide",[a])}};d.deflect=function(){this.role="fluff";this.rotateSpeed=5*this.speed;this.speed*=0.5;this.spriteAlign=!1;this.rotate=!0;this.ttl=100;this.alpha=0.5;this.bounce=!0};d.setDirection=function(a){0===a.x&&0===a.y?this.stopMoving():(this.direction=a,this.facing=
this.direction.clone())};d.reverseDirection=function(){var a=this.direction.clone();a.scale(-1);this.setDirection(a)};d.chase=function(a){this.moveToward(a.position.clone())};d.moveToward=function(a){a=a.clone().subtract(this.position).normalize();this.setDirection(a)};d.isMoving=function(){return this.hasState(c.Object.states.DYING)?!1:0!==this.direction.x||0!==this.direction.y};d.stopMoving=function(){this.direction.zero()};d.execute=function(a,b){if(this[a])return this[a].apply(this,b)};d.getWeaponInfo=
function(){var a=this.weapons.length;return 1<=a?(0>this.currentWeaponIndex&&(this.currentWeaponIndex=0),this.currentWeaponIndex>a-1&&(this.currentWeaponIndex=a-1),this.weapons[this.currentWeaponIndex]):!1};d.addWeapon=function(a,b){var c=[],d;for(d in this.weapons){var e=this.weapons[d];"undefined"!==typeof e&&e.type===a&&(b=null!==e.count?b+e.count:null);null!==e.count&&c.push(d)}for(var h in c)this.weapons=this.weapons.splice(h,1);this.currentWeaponIndex=this.weapons.push({type:a,count:b})-1};
d.cycleWeapon=function(a){var b=this.weapons.length;!0===a?(this.currentWeaponIndex--,0>this.currentWeaponIndex&&(this.currentWeaponIndex=b-1)):(this.currentWeaponIndex++,this.currentWeaponIndex>b-1&&(this.currentWeaponIndex=0))};d.fireWeapon=function(){var a=this.weapons.length;if(!0===this.cooldown||1>a)return!1;a=this.getWeaponInfo();null!==a.count&&(a.count-=1,1>a.count&&this.weapons.splice(this.currentWeaponIndex,1));this.cooldown=!0;return a.type};d.hasWeapon=function(a){for(var b=this.weapons.length,
c=0;c<b;++c)if(this.weapons[c].type===a)return!0;return!1};c.objectTypes={};d=c.objectTypes;d.hero={role:"hero",team:0,speed:150,hitPoints:100,damage:0,damageType:null,spriteSheet:"characters",spriteY:992,animated:!0,soundAttacks:"hero_attacks",soundDamage:"hero_damage",soundDies:"hero_dies",weapons:[{type:"h_sword",count:null}],isMeatboy:!1,bloodTimer:null,onInit:function(){this.isMeatboy&&this.initMeatBoy()},initMeatBoy:function(){this.hitPoints=1;this.spriteY=1024;this.bloodTimer=new c.Timer;this.bloodTimer.start(100)},
onUpdate:function(a,b){if(this.isMeatboy&&(this.bloodTimer.update(a),this.bloodTimer.expired()&&this.isMoving())){var d=b.spawnObject(this,"blood_pool"),d=b.objects[d];d.position.x+=c.randomRange(-8,8);d.position.y+=c.randomRange(-8,8);d.angle=c.randomRange(0,1.5*Math.PI);this.bloodTimer.start(c.randomRange(75,150))}},onKilled:function(a,b){for(var d=0;10>d;++d){var e=c.makeObject("mini_skull");e.position.x=this.position.x+d*(this.size.width/10);e.position.y=this.position.y+this.size.height-c.randomRange(0,
this.size.height);b.addObject(e)}}};d.blood_pool={role:"fluff",size:new c.Size(32,32),speed:0,ttl:1250,collidable:!1,spriteSheet:"objects",spriteX:128,spriteY:32,drawIndex:0};d.h_sword={role:"projectile",cooldown:300,speed:250,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:64,spriteY:0,spriteAlign:!0,priority:0,bounce:!1,achievementId:"masterswords",deathsForAchievement:1E3};d.h_knife={role:"projectile",size:new c.Size(32,30),cooldown:200,speed:350,hitPoints:1,damage:5,spriteSheet:"objects",
spriteX:32,spriteY:0,spriteAlign:!0,priority:1,bounce:!1};d.h_spear={role:"projectile",cooldown:350,speed:500,hitPoints:1,damage:15,spriteSheet:"objects",spriteX:96,spriteY:0,spriteAlign:!0,priority:2,bounce:!1,piercing:!0};d.h_fireball={role:"projectile",cooldown:300,speed:400,rotateSpeed:500,hitPoints:1,damage:3,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,ttl:450,soundAttacks:"fire_attack",priority:3,bounce:!1,damageType:"magic",onInit:function(){this.trailTimer=new c.Timer;this.trailTimer.start(75)},
onUpdate:function(a,b){this.trailTimer.update(a);this.trailTimer.expired()&&(b.spawnObject(this,"h_fireball_trail"),this.trailTimer.reset())},achievementId:"masterfire",deathsForAchievement:1E3};d.h_fireball_trail={role:"projectile",speed:0,rotateSpeed:150,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,ttl:500,alpha:0.5,priority:3,bounce:!1,damageType:"magic",drawIndex:0,ignoreLogDeath:!0};d.h_axe={role:"projectile",cooldown:500,speed:225,hitPoints:1,damage:20,spriteSheet:"objects",
spriteX:192,spriteY:32,rotate:!0,rotateSpeed:700,priority:5,ttl:4E3,piercing:!0,achievementId:"masteraxes",deathsForAchievement:1E3};d.h_fire_sword={role:"projectile",cooldown:450,speed:350,hitPoints:1,damage:25,spriteSheet:"objects",spriteX:384,spriteY:0,priority:6,bounce:!1,spriteAlign:!0,piercing:!0,soundAttacks:"fire_attack",damageType:"magic",onInit:function(){this.spawnTimer=new c.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,
"fire_sword_trail"),this.spawnTimer.reset())},achievementId:"masterfireswords",deathsForAchievement:1E3};d.fire_sword_trail={role:"projectile",speed:0,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,soundAttacks:"fire_attack",ttl:500,bounce:!1,drawIndex:0,damageType:"magic",ignoreLogDeath:!0};d.h_fire_knife={role:"projectile",size:new c.Size(32,30),cooldown:200,speed:350,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:128,spriteY:0,priority:6,bounce:!1,spriteAlign:!0,
piercing:!0,soundAttacks:"fire_attack",damageType:"magic",onInit:function(){this.spawnTimer=new c.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"fire_sword_trail"),this.spawnTimer.reset())}};d.h_firebomb={role:"projectile",cooldown:500,speed:150,rotateSpeed:300,hitPoints:1,damage:2,spriteSheet:"objects",spriteX:192,spriteY:0,rotate:!0,ttl:550,soundAttacks:"fire_attack",priority:3,bounce:!1,damageType:"magic"};var l=
{chase:function(a,b){if(0<this.moveChangeDelay){this.moveChangeElapsed+=a;if(this.moveChangeElapsed<this.moveChangeDelay)return;this.moveChangeElapsed=0}var c=b.getPlayerObject();this.chase(c);return"shoot"},getNear:function(a,b){this.speed=this.defaultSpeed;var c=b.getPlayerObject(),d=c.position.clone().subtract(this.position).magnitude();if(100>d)this.chase(c),this.setDirection(this.direction.invert());else if(150<d)this.chase(c);else if(this.cooldown)l.wander.apply(this,arguments);else return this.chase(c),
this.speed=0,"shoot"},wander:function(a){this.moveChangeElapsed+=a;this.moveChangeElapsed>=this.moveChangeDelay&&(this.moveChangeElapsed=0,a=c.randomDirection(),0===a.x&&0===a.y||this.setDirection(a))},wanderShoot:function(a,b){var c=b.getPlayerObject(),d=c.position.clone().subtract(this.position).abs();if(!this.cooldown&&(d.x<c.size.width/2||d.y<c.size.height/2))return this.chase(c),"shoot";l.wander.apply(this,arguments)},wanderThenChase:function(a,b){var d=b.getPlayerObject(),e=d.position.x,d=d.position.y,
f=this.position.x,h=this.position.y;if(this.seenHero)l.chase.apply(this,arguments);else if(l.wander.apply(this,arguments),e=Math.abs(f-e),d=Math.abs(h-d),64>e&&64>d)return c.sound.play(this.soundAttacks),this.seenHero=!0,"shoot"}};d.bat={role:"monster",team:1,speed:100,hitPoints:5,damage:2,worth:0,spriteSheet:"characters",spriteY:96,animated:!0,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",achievementId:"killbats",deathsForAchievement:1E3,lootTable:[{type:null,
weight:9},{type:"item_coin",weight:1}],onInit:function(){this.moveChangeDelay=c.randomRange(500,1E3)},onUpdate:function(){50<=this.position.y&&(this.onUpdate=l.wander)}};d.dire_bat={role:"monster",team:1,speed:150,hitPoints:10,damage:5,worth:0,spriteSheet:"characters",spriteY:128,animated:!0,animDelay:150,moveChangeElapsed:0,moveChangeDelay:500,soundDamage:"bat_damage",soundDies:"bat_dies",lootTable:[{type:null,weight:7},{type:"item_coin",weight:3}],onInit:function(){this.moveChangeDelay=c.randomRange(500,
1E3)},onUpdate:function(){50<=this.position.y&&(this.onUpdate=l.wander)}};d.goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:0,spriteSheet:"characters",spriteY:160,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:6},{type:"item_coin",weight:1},{type:"WEAPON_DROP",weight:2},{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=
c.randomRange(500,1E3)},onUpdate:function(){50<=this.position.y&&(this.onUpdate=l.wanderShoot)}};d.hunter_goblin={role:"monster",team:1,speed:75,hitPoints:10,damage:10,worth:0,spriteSheet:"characters",spriteY:160,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_arrow",count:null}],soundAttacks:"goblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:2},{type:"item_coin",weight:4},{type:"WEAPON_DROP",weight:2},{type:"item_food",
weight:2}],onInit:function(){this.moveChangeDelay=c.randomRange(500,1E3)},onUpdate:function(a,b){if(50<=this.position.y){if(!this.cooldown)return this.chase(b.getPlayerObject()),"shoot";l.wander.apply(this,arguments)}}};d.demoblin={role:"monster",team:1,speed:75,defaultSpeed:75,hitPoints:30,damage:15,worth:0,spriteSheet:"characters",spriteY:192,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_trident",count:null}],lootTable:[{type:null,weight:6},{type:"WEAPON_DROP",
weight:2},{type:"item_chest",weight:1},{type:"item_food",weight:1}],soundAttacks:"demoblin_attacks",soundDamage:"goblin_damage",soundDies:"goblin_dies",onInit:function(){this.moveChangeDelay=c.randomRange(500,1E3);this.cooldown=!0;this.cooldownElapsed=c.randomRange(0,5E3)},onUpdate:function(){50<=this.position.y&&(this.onUpdate=l.getNear)}};d.flaming_skull={role:"monster",team:1,speed:200,hitPoints:50,damage:10,worth:0,spriteSheet:"characters",spriteY:32,animated:!0,setDir:!1,soundDamage:"skull_damage",
soundDies:"skull_dies",weapons:[{type:"e_static_blue_fire",count:null}],lootTable:[{type:null,weight:6},{type:"WEAPON_DROP",weight:2},{type:"item_chest",weight:2}],onInit:function(){switch(c.randomRange(1,2)){case 1:this.speed*=0.5;this.animDelay*=0.5;break;case 2:this.speed*=0.75,this.animDelay*=0.75}},onUpdate:function(){if(!this.setDir&&50<=this.position.y){var a=this.direction.clone();a.x=Math.random();0.5<=Math.random()&&(a.x*=-1);this.setDirection(a);this.setDir=!0}return"shoot"}};d.huge_skull=
{role:"monster",team:1,badass:!0,speed:150,hitPoints:200,damage:20,worth:0,spriteSheet:"characters",spriteY:864,animated:!0,size:new c.Size(64,64),setDir:!1,soundDamage:"skull_damage",soundDies:"skull_dies",achievementId:"killskulls",deathsForAchievement:100,weapons:[{type:"e_static_green_fire",count:null}],lootTable:[{type:null,weight:4},{type:"WEAPON_DROP",weight:3},{type:"item_chest",weight:3}],onInit:function(){this.phaseTimer=new c.Timer;switch(c.randomRange(1,2)){case 1:this.speed*=0.5;this.animDelay*=
0.5;break;case 2:this.speed*=0.75,this.animDelay*=0.75}},onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.phaseInit=!0);50<=this.position.y&&this.nextPhase();break;case 1:if(!this.phaseInit){var d=this.direction.clone();d.x=Math.random();0.5<=Math.random()&&(d.x*=-1);this.setDirection(d);this.phaseTimer.start(c.randomRange(2E3,4E3));this.phaseInit=!0}this.phaseTimer.expired()&&this.nextPhase();break;case 2:this.phaseInit||(this.speed*=2,this.animDelay*=2,this.phaseTimer.start(c.randomRange(250,
500)),this.phaseInit=!0),this.phaseTimer.expired()&&(this.speed/=2,this.animDelay/=2,this.setPhase(1)),this.chase(b.getPlayerObject())}return"shoot"}};d.spike_wall={role:"trap",team:1,speed:150,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:32,spriteY:256,drawIndex:0,animated:!0,animNumFrames:1,spawnFramesX:96,spawnFramesY:576,spawnFrameCount:2,rotate:!0,rotateSpeed:0,onInit:function(){this.phaseTimer=new c.Timer;this.spinUpTime=7500;this.wallDirection=new c.Vector2(0,1);this.addState(c.Object.states.SPAWNING)},
onDamage:function(){this.spriteX=128},onUpdate:function(a){switch(this.phase){case 0:this.phaseInit||(this.phaseTimer.start(this.spinUpTime),this.phaseInit=!0);this.rotateSpeed+=this.spinUpTime/200/1E3*a;this.phaseTimer.expired()&&this.nextPhase();break;case 1:this.phaseInit||(c.sound.play("spike_attack"),this.setDirection(this.wallDirection),this.phaseInit=!0)}},onWallCollide:function(){this.stopMoving();this.ttl=1500}};d.spike_sentry={role:"trap",team:1,speed:100,hitPoints:Infinity,damage:10,worth:0,
spriteSheet:"objects",spriteX:64,spriteY:256,animated:!0,animNumFrames:1,spawnFramesX:0,spawnFramesY:576,spawnFrameCount:2,rotate:!0,rotateSpeed:100,phase:0,phaseInit:!1,onInit:function(){this.addState(c.Object.states.SPAWNING)},onDamage:function(a){"hero"===a.role&&(this.spriteX=160)},onUpdate:function(a,b){if(!this.hasState(c.Object.states.SPAWNING))switch(this.phase){case 0:this.phaseInit||(this.stopMoving(),this.phaseInit=!0);var d=b.getPlayerObject().position.clone().subtract(this.position);
if(32>Math.abs(d.y)){this.originalPos=this.position.clone();var e=new c.Vector2;e.x=0>d.x?-1:1;this.setDirection(e);this.phase++;this.phaseInit=!1;c.sound.play("spike_attack")}else 32>Math.abs(d.x)&&(this.originalPos=this.position.clone(),e=new c.Vector2,e.y=0>d.y?-1:1,this.setDirection(e),this.phase++,this.phaseInit=!1,c.sound.play("spike_attack"));break;case 1:this.phaseInit||(this.rotateSpeed=this.speed=300,this.phaseInit=!0);d=this.position.clone().subtract(this.originalPos).abs();256<d.x?(e=
this.direction.clone(),e.x*=-1,this.setDirection(e),this.phase++,this.phaseInit=!1):128<d.y&&(e=this.direction.clone(),e.y*=-1,this.setDirection(e),this.phase++,this.phaseInit=!1);break;case 2:this.phaseInit||(this.speed=50,this.rotateSpeed=100,this.phaseInit=!0),d=this.position.clone().subtract(this.originalPos).abs(),5>d.x&&5>d.y&&(this.stopMoving(),this.position=this.originalPos.clone(),this.phase=0,this.phaseInit=!1)}}};d.spikes={role:"trap",team:1,speed:0,hitPoints:Infinity,damage:10,worth:0,
spriteSheet:"objects",spriteX:0,spriteY:256,animated:!0,animNumFrames:1,spawnFramesX:224,spawnFramesY:256,spawnFrameCount:3,collidable:!1,onInit:function(){this.addState(c.Object.states.SPAWNING)},onDamage:function(a){"hero"===a.role&&(this.spriteX=96)}};d.owlbear={role:"monster",team:1,badass:!0,animated:!0,size:new c.Size(64,64),spriteSheet:"characters",spriteY:800,damage:15,hitPoints:250,speed:75,soundAlarm:"owlbear_alarm",soundAttacks:"owlbear_attacks",soundDamage:"owlbear_damage",soundDies:"owlbear_dies",
achievementId:"killowlbears",deathsForAchievement:100,lootTable:[{type:"item_food",weight:1}],onInit:function(){this.moveChangeDelay=c.randomRange(500,1E3);this.phaseTimer=new c.Timer},onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.animDelay=this.speed=150,this.phaseInit=!0);60<=this.position.y&&this.nextPhase();break;case 1:this.phaseInit||(this.speed=75,this.animDelay=300,this.phaseInit=!0);l.wander.apply(this,arguments);var d=b.getPlayerObject(),e=d.position.clone().subtract(this.position).abs();
if(e.x<this.size.width/2||e.y<this.size.height/2)this.chase(d),this.nextPhase();break;case 2:this.phaseInit||(c.sound.play(this.soundAlarm),this.speed=0,this.animDelay=150,this.phaseTimer.start(500),this.phaseInit=!0);this.position.x+=c.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();break;case 3:this.phaseInit||(c.sound.play(this.soundAttacks),this.speed=350,this.animDelay=75,this.phaseTimer.start(2E3),this.phaseInit=!0);this.phaseTimer.expired()&&this.nextPhase();break;case 4:this.phaseInit||
(this.stopMoving(),this.animDelay=400,this.phaseTimer.start(1250),this.phaseInit=!0),this.phaseTimer.expired()&&this.setPhase(1)}}};d.cyclops={role:"monster",team:1,badass:!0,animated:!0,gibletSize:"large",size:new c.Size(64,64),spriteSheet:"characters",spriteY:224,moveChangeElapsed:0,moveChangeDelay:1E3,damage:20,hitPoints:200,speed:100,animDelay:100,worth:0,soundAttacks:"cyclops_attacks",soundDamage:"cyclops_damage",soundDies:"cyclops_dies",weapons:[{type:"e_boulder",count:null}],lootTable:[{type:"item_food",
weight:7},{type:"WEAPON_DROP",weight:3}],onInit:function(){this.moveChangeDelay=c.randomRange(500,1E3);this.setDirection(c.directions.toVector(c.directions.DOWN))},onUpdate:function(){50<=this.position.y&&(this.speed=25,this.animDelay=200,this.onUpdate=l.chase)}};d.eyelet={role:"monster",team:1,animated:!0,spriteSheet:"characters",spriteY:512,damage:10,hitPoints:40,speed:100,soundDamage:"eyelet_damage",soundDies:"eyelet_dies",collidable:!1,lootTable:[{type:null,weight:9},{type:"item_food",weight:1},
{type:"WEAPON_DROP",weight:8},{type:"item_weapon_fireball",weight:2}],makeBadass:function(){this.spriteY=960;this.hitPoints=50;this.speed=150;this.damage=20},onInit:function(){5<c.randomRange(1,10)&&(this.spriteY+=32);this.ownerAngle=0;this.phaseTimer=new c.Timer;this.addState(c.Object.states.INVINCIBLE,1E3)},onUpdate:function(a,b){if(b.objects[this.ownerId])switch(this.phase){case 0:this.phaseInit||(this.phaseTimer.start(1E4),this.phaseInit=!0);var d=b.objects[this.ownerId],e=d.position.clone().add(c.Vector2.fromSize(d.size).scale(0.5)).subtract(new c.Vector2(10,
10)),f=c.Vector2.fromHeading(this.ownerAngle);this.position=e.add(f.scale(d.eyeletOffset));this.ownerAngle+=1.05/1E3*a;this.ownerAngle>2*Math.PI&&(this.ownerAngle=0);this.phaseTimer.expired()&&!1===b.checkTileCollision(this)&&this.nextPhase();break;case 1:this.phaseInit||(this.collidable=!0,this.speed=175,this.phaseInit=!0),l.wander.apply(this,arguments)}else this.wound(this.hitPoints)}};d.cube={role:"monster",team:1,badass:!0,animated:!0,animDelay:400,gibletSize:"large",size:new c.Size(64,64),spriteSheet:"characters",
spriteY:576,moveChangeElapsed:0,moveChangeDelay:1E3,damage:35,hitPoints:750,speed:15,worth:0,soundAttacks:"cube_attacks",soundDamage:"cube_damage",soundDies:"cube_dies",achievementId:"defeatgel",deathsForAchievement:1,lootTable:[{type:"item_gold_chest",weight:1}],onInit:function(){this.moveChangeDelay=c.randomRange(500,1E3);this.setDirection(c.directions.toVector(c.directions.DOWN));this.phaseTimer=new c.Timer;this.gelTimer=new c.Timer},onThreat:function(a){if("magic"!==a.damageType)return!0},onUpdate:function(a,
b){this.gelTimer.update(a);switch(this.phase){case 0:this.phaseInit||(this.speed=100,this.animDelay=200,this.phaseInit=!0);150<=this.position.y&&this.nextPhase();break;case 1:this.phaseInit||(this.stopMoving(),this.speed=15,this.animDelay=400,this.phaseTimer.start(6E3),this.gelTimer.start(300),this.phaseInit=!0);if(this.phaseTimer.expired()){this.nextPhase();break}l.wander.apply(this,arguments);this.position.x+=c.randomRange(-1,1);this.gelTimer.expired()&&(b.spawnObject(this,"gel"),c.sound.play(this.soundAttacks),
this.gelTimer.reset());break;case 2:this.phaseInit||(this.speed=30,this.animDelay=150,this.phaseTimer.start(7500),this.phaseInit=!0);if(this.phaseTimer.expired()){this.setPhase(1);break}l.chase.apply(this,arguments)}}};d.gel={role:"monster",team:1,animated:!0,animDelay:400,spriteSheet:"characters",spriteY:640,moveChangeElapsed:0,moveChangeDelay:1E3,damage:5,hitPoints:10,speed:150,worth:0,soundDamage:"gel_damage",soundDies:"gel_dies",onInit:function(){this.setDirection(c.randomDirection());this.moveChangeDelay=
c.randomRange(500,1E3);switch(c.randomRange(1,4)){case 1:this.spriteY=640;break;case 2:this.spriteY=672;break;case 3:this.spriteY=704;break;case 4:this.spriteY=736}},onUpdate:function(a,b){l.wander.apply(this,arguments)},onKilled:function(a,b){var c=b.getPlayerObject();!c.hasWeapon("h_fireball")&&(!c.hasWeapon("h_fire_sword")&&0===b.getObjectCountByType("item_weapon_fireball"))&&b.dropObject(this,"item_weapon_fireball")}};d.superclops={role:"monster",team:1,badass:!0,animated:!0,gibletSize:"large",
size:new c.Size(64,64),spriteSheet:"characters",spriteY:288,moveChangeElapsed:0,moveChangeDelay:1E3,damage:20,hitPoints:750,speed:25,worth:0,soundAttacks:"minotaur_attacks",soundDamage:"minotaur_damage",soundDies:"minotaur_dies",achievementId:"defeatminotaur",deathsForAchievement:1,weapons:[{type:"e_minotaur_trident",count:null}],lootTable:[{type:"item_gold_chest",weight:1}],onInit:function(){this.phaseTimer=new c.Timer;this.moveChangeDelay=c.randomRange(500,1E3);this.setDirection(c.directions.toVector(c.directions.DOWN))},
onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.speed=200,this.animDelay=100,this.phaseInit=!0);80<=this.position.y&&this.nextPhase();break;case 1:if(!this.phaseInit){this.animDelay=250;var d=b.getPlayerObject();this.chase(d);this.stopMoving();d=this.facing.heading();b.spawnObject(this,"e_bouncing_boulder",c.Vector2.fromHeading(d-0.3));b.spawnObject(this,"e_bouncing_boulder",c.Vector2.fromHeading(d+0.3));this.phaseTimer.start(1500);this.phaseInit=!0}this.phaseTimer.expired()&&
this.nextPhase();break;case 2:this.phaseInit||(this.speed=300,this.animDelay=100,this.setDirection(this.facing),this.phaseTimer.start(2E3),this.phaseInit=!0);this.phaseTimer.expired()&&this.nextPhase();break;case 3:this.phaseInit||(this.speed=15,this.animDelay=400,this.phaseTimer.start(2E3),this.phaseInit=!0);l.wander.apply(this,arguments);this.phaseTimer.expired()&&(this.wounds>this.hitPoints/2?this.nextPhase():this.setPhase(1));break;case 4:this.phaseInit||(this.stopMoving(),this.animDelay=300,
this.phaseTimer.start(1500),this.phaseInit=!0);if(this.phaseTimer.expired()){this.nextPhase();break}this.position.x+=c.randomRange(-1,1);break;case 5:this.phaseInit||(this.cooldown=!1,this.weapons=[{type:"e_bouncing_boulder",count:null}],this.phaseInit=!0);b.objectAttack(this);this.position.x+=c.randomRange(-1,1);this.nextPhase();break;case 6:this.phaseInit||(this.speed=50,this.weapons=[{type:"e_minotaur_trident",count:null}],this.cooldown=!0,this.phaseTimer.start(6E3),this.phaseInit=!0),this.phaseTimer.expired()&&
this.setPhase(4),b.objectAttack(this),l.chase.apply(this,arguments)}},onWallCollide:function(){2===this.phase&&this.nextPhase()}};d.imp={role:"monster",team:1,speed:100,hitPoints:20,damage:15,worth:0,spriteSheet:"characters",spriteY:64,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,soundDamage:"imp_damage",soundDies:"imp_dies",phase:0,phaseInit:!1,lootTable:[{type:null,weight:7},{type:"item_food",weight:1},{type:"WEAPON_DROP",weight:2}],onInit:function(){this.phaseTimer=new c.Timer;
this.moveChangeDelay=c.randomRange(500,1E3)},onKilled:function(a,b){"projectile"===a.role&&a.die();for(var d=0;2>d;++d)b.spawnObject(this,"dire_bat",c.randomDirection(),!1)},onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.phaseInit=!0);50<=this.position.y&&(this.phase++,this.phaseInit=!1);break;case 1:this.phaseInit||(this.speed=50,this.animDelay=400,this.phaseTimer.start(2500,7500),this.phaseInit=!0);l.wander.apply(this,arguments);this.phaseTimer.expired()&&(this.phase++,this.phaseInit=
!1);break;case 2:this.phaseInit||(this.animDelay=this.speed=150,this.phaseTimer.start(2500,7500),this.phaseInit=!0),l.wander.apply(this.arguments),this.phaseTimer.expired()&&(this.phase=1,this.phaseInit=!1)}}};d.wizard={role:"monster",team:1,speed:100,hitPoints:20,damage:10,worth:0,spriteSheet:"characters",spriteY:416,animated:!0,gibletSize:"medium",moveChangeElapsed:0,moveChangeDelay:3E3,weapons:[{type:"e_shock_wave",count:null}],soundAttacks:"wizard_attacks",soundDisappear:"wizard_disappear",soundReappear:"wizard_reappear",
soundDamage:"goblin_damage",soundDies:"goblin_dies",lootTable:[{type:null,weight:6},{type:"item_chest",weight:2},{type:"WEAPON_DROP",weight:2}],phase:0,phaseInit:!1,onInit:function(){this.phaseTimer=new c.Timer;this.moveChangeDelay=c.randomRange(500,1E3);this.moveToY=c.randomRange(50,75)},onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.phaseInit=!0);this.position.y>=this.moveToY&&(this.phase++,this.phaseInit=!1);break;case 1:this.phaseInit||(this.animated=!1,this.stopMoving(),
this.addState(c.Object.states.INVINCIBLE),this.phaseTimer.start(1E3),this.phaseInit=!0,c.sound.play(this.soundDisappear));this.phaseTimer.expired()&&(this.phase++,this.phaseInit=!1);break;case 2:this.phaseInit||(this.speed=500,this.addState(c.Object.states.INVISIBLE),this.phaseTimer.start(c.randomRange(1E3,2E3)),this.phaseInit=!0);var d=this.boundingBox().center(),d=b.getPlayerObject().boundingBox().center().clone().subtract(d).abs();l.wander.apply(this,arguments);this.phaseTimer.expired()&&90<d.magnitude()&&
(this.phase++,this.phaseInit=!1);break;case 3:this.phaseInit||(this.stopMoving(),this.removeState(c.Object.states.INVISIBLE),this.phaseTimer.start(1E3),this.phaseInit=!0,c.sound.play(this.soundReappear));this.phaseTimer.expired()&&(this.phase++,this.phaseInit=!1);break;case 4:if(this.phaseInit||(this.speed=0,this.animated=!0,this.removeState(c.Object.states.INVINCIBLE),this.phaseTimer.start(c.randomRange(2E3,3E3)),this.phaseInit=!0,this.shotOnce=!1),d=b.getPlayerObject(),this.chase(d),this.phaseTimer.expired()&&
(this.phase=1,this.phaseInit=!1),!this.shotOnce)return this.shotOnce=!0,"shoot"}}};d.sandworm={role:"monster",team:1,animated:!0,animDelay:200,spriteSheet:"characters",spriteY:480,spawnFramesX:544,spawnFramesY:448,spawnFrameCount:2,damage:25,hitPoints:50,speed:50,worth:0,phase:0,phaseInit:!1,moveChangeElapsed:0,moveChangeDelay:2E3,soundAttacks:"sandworm_attacks",soundDamage:"goblin_damage",soundDies:"sandworm_dies",lootTable:[{type:null,weight:4},{type:"item_chest",weight:2},{type:"WEAPON_DROP",weight:2},
{type:"item_food",weight:2}],onInit:function(){this.phaseTimer=new c.Timer;this.dirtTimer=new c.Timer;this.attackTimer=new c.Timer},onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.speed=50,this.addState(c.Object.states.INVISIBLE),this.phaseTimer.start(c.randomRange(5E3,1E4)),this.dirtTimer.start(150),this.phaseInit=!0);this.dirtTimer.update(a);50>=this.position.y?this.setDirection(c.directions.toVector(c.directions.DOWN)):l.wander.apply(this,arguments);this.phaseTimer.expired()&&
(this.phase++,this.phaseInit=!1);this.dirtTimer.expired()&&(b.spawnObject(this,"e_dirt_pile"),this.dirtTimer.reset());break;case 1:this.phaseInit||(this.stopMoving(),this.speed=0,this.removeState(c.Object.states.INVISIBLE),this.addState(c.Object.states.SPAWNING),this.spawnFrameIndex=0,this.phaseInit=!0);this.hasState(c.Object.states.SPAWNING)||(this.phase++,this.phaseInit=!1);break;case 2:this.phaseInit||(this.phaseAttacks=0,this.phaseInit=!0,this.attackTimer.start(200));this.attackTimer.update(a);
1>this.phaseAttacks&&this.attackTimer.expired()&&(this.phaseAttacks++,this.setDirection(c.randomDirection()),b.spawnObject(this,"e_worm_spit"),c.sound.play(this.soundAttacks),this.attackTimer.reset(),1===this.phaseAttacks&&this.phaseTimer.start(2E3));1<=this.phaseAttacks&&this.phaseTimer.expired()&&(this.phase++,this.phaseInit=!1);break;case 3:this.phaseInit||(this.addState(c.Object.states.DESPAWNING),this.spawnFrameIndex=2,this.phaseInit=!0),this.hasState(c.Object.states.DESPAWNING)||(this.addState(c.Object.states.INVISIBLE),
this.phase=0,this.phaseInit=!1)}}};d.doppelganger={role:"monster",team:1,badass:!0,animated:!0,spriteSheet:"characters",spriteY:0,spriteY:768,spriteYOverlay:928,damage:20,hitPoints:5E3,speed:200,soundAttacks:"dopp_attacks",soundDamage:"dopp_damage",soundDies:"dopp_dies",achievementId:"defeatdoppelganger",deathsForAchievement:1,onInit:function(){this.phaseTimer=new c.Timer},onKilled:function(a,b){for(var c in b.objects){var d=b.objects[c];"monster"===d.role&&d.id!==this.id?d.wound(d.hitPoints):"trap"===
d.role&&(d.ttl=1500)}},onUpdate:function(a,b){switch(this.phase){case 0:this.phaseInit||(this.speed=300,this.animDelay=100,this.phaseInit=!0);100<this.position.y&&this.nextPhase();break;case 1:this.phaseInit||(this.animDelay=this.speed=200,this.waypoints=this.getPattern(),this.currentWaypoint=this.waypoints.shift(),this.phaseInit=!0);this.moveToward(this.currentWaypoint);var d=this.currentWaypoint.clone().subtract(this.position).abs().magnitude();10>d&&(this.position=this.currentWaypoint.clone(),
this.nextPhase());break;case 2:this.phaseInit||(this.setDirection(new c.Vector2(0,1)),this.stopMoving(),this.phaseTimer.start(500),this.phaseInit=!0);this.position.x+=c.randomRange(-1,1);this.phaseTimer.expired()&&this.nextPhase();break;case 3:this.phaseInit||(this.currentWaypoint=this.waypoints.shift(),this.speed=400,this.animDelay=100,this.phaseInit=!0,this.spikeTimer=new c.Timer,this.spikeTimer.start(200));this.spikeTimer.update(a);if(this.spikeTimer.expired()){c.sound.play("spike_attack");var e=
b.spawnObject(this,"spikes");if(e=b.objects[e])e.ttl=1E4;this.spikeTimer.reset()}this.moveToward(this.currentWaypoint);d=this.currentWaypoint.clone().subtract(this.position).abs().magnitude();10>d&&(this.position=this.currentWaypoint.clone(),0<this.waypoints.length?this.currentWaypoint=this.waypoints.shift():this.nextPhase());break;case 4:this.phaseInit||(this.speed=100,this.animDelay=200,this.phaseTimer.start(7500),this.phaseInit=!0);d=b.getPlayerObject();d.wounds<d.hitPoints&&this.chase(d);this.phaseTimer.expired()&&
this.nextPhase();break;case 5:this.phaseInit||(this.animDelay=this.speed=200,this.phaseInit=!0,this.targetPos=new c.Vector2(32,66));this.moveToward(this.targetPos);d=this.targetPos.clone().subtract(this.position).abs().magnitude();10>d&&(this.position=this.targetPos.clone(),this.nextPhase());break;case 6:this.phaseInit||(this.setDirection(new c.Vector2(0,1)),this.stopMoving(),this.phaseInit=!0,this.makeSpikeWalls(b),this.weapons=[{type:"e_dopp_sword",count:null}]);this.phaseTimer.expired()&&this.nextPhase();
this.chase(b.getPlayerObject());this.stopMoving();if(this.wounds>0.33*this.hitPoints)return"shoot";break;case 7:this.phaseInit||(this.stopMoving(),this.phaseTimer.start(4E3),this.phaseInit=!0);this.phaseTimer.expired()&&(d=c.makeObject("item_food"),d.position.x=32,d.position.y=64,b.addObject(d),this.nextPhase());break;case 8:this.phaseInit||(this.animDelay=this.speed=200,this.weapons=[{type:"e_dopp_axe",count:null}],this.cooldown=!1,this.waypoints=this.getPattern(),this.currentWaypoint=this.waypoints.shift(),
this.axeTimer=new c.Timer,this.axeTimer.start(3E3),this.axeTimer.update(3E3),this.phaseInit=!0);this.axeTimer.update(a);this.axeTimer.expired()&&(this.chase(b.getPlayerObject()),b.spawnObject(this,"e_dopp_axe"),this.axeTimer.reset());this.moveToward(this.currentWaypoint);d=this.currentWaypoint.clone().subtract(this.position).abs().magnitude();10>d&&(this.position=this.currentWaypoint.clone(),0<this.waypoints.length?this.currentWaypoint=this.waypoints.shift():this.nextPhase());break;case 9:this.phaseInit||
(this.animDelay=this.speed=200,this.phaseInit=!0,this.targetPos=new c.Vector2(304,224));this.moveToward(this.targetPos);d=this.targetPos.clone().subtract(this.position).abs().magnitude();10>d&&(this.position=this.targetPos.clone(),this.nextPhase());break;case 10:if(!this.phaseInit){c.sound.play("minotaur_dies");this.setDirection(new c.Vector2(0,1));this.stopMoving();this.phaseInit=!0;for(d=0;60>d;++d)e=b.spawnObject(this,"dire_bat"),e=b.objects[e],e.setDirection(c.randomDirection()),e.addState(c.Object.states.INVINCIBLE,
250);this.phaseTimer.start(8E3)}this.phaseTimer.expired()&&this.setPhase(1)}},getPattern:function(){switch(c.randomRange(1,3)){case 1:return[new c.Vector2(64,320),new c.Vector2(64,96),new c.Vector2(544,96),new c.Vector2(544,320),new c.Vector2(128,320),new c.Vector2(128,160),new c.Vector2(480,160),new c.Vector2(480,256),new c.Vector2(192,256)];case 2:return[new c.Vector2(576,352),new c.Vector2(32,352),new c.Vector2(32,288),new c.Vector2(576,288),new c.Vector2(576,224),new c.Vector2(32,224),new c.Vector2(32,
160),new c.Vector2(576,160),new c.Vector2(576,96),new c.Vector2(32,96)];case 3:return[new c.Vector2(576,64),new c.Vector2(32,64),new c.Vector2(288,192),new c.Vector2(32,352),new c.Vector2(576,352),new c.Vector2(352,224),new c.Vector2(576,64)]}},makeSpikeWalls:function(a){c.sound.play("wizard_reappear");var b=3,d=5E3,e=2;this.wounds>0.66*this.hitPoints?(b=1,d=5E3,e=2):this.wounds>0.33*this.hitPoints&&(b=2,d=7500,e=1.5);this.phaseTimer.start(d-1500);for(var f=[],h=0;18>h;++h)f.push(!0);for(h=0;h<b;++h){for(var i=
0,l=!1;!1===l;)i=c.randomRange(3,f.length-1),l=!0===f[i];f[i]=!1}for(h=0;h<f.length;++h)!0===f[h]&&(i=c.makeObject("spike_wall"),i.position=new c.Vector2(32+32*h,64),i.spinUpTime=d,i.speed*=e,a.addObject(i));f=[];for(h=0;10>h;++h)f.push(!0);for(h=0;h<b;++h){i=0;for(l=!1;!1===l;)i=c.randomRange(3,f.length-1),l=!0===f[i];f[i]=!1}for(h=0;h<f.length;++h)!0===f[h]&&(i=c.makeObject("spike_wall"),i.position=new c.Vector2(32,64+32*h),i.wallDirection=new c.Vector2(1,0),i.spinUpTime=d,i.speed=275,i.speed*=
e,a.addObject(i))}};d.e_dopp_axe={role:"projectile",cooldown:2500,speed:250,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:160,spriteY:32,rotate:!0,rotateSpeed:700,priority:5,ttl:1E4,soundAttacks:"dopp_attacks",onInit:function(){this.spawnTimer=new c.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){b.objectExists(this.ownerId)||this.die();this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"e_dopp_fire"),this.spawnTimer.reset())},ignoreLogDeath:!0};d.e_dopp_sword=
{role:"projectile",cooldown:750,speed:350,hitPoints:Infinity,damage:5,spriteSheet:"objects",spriteX:384,spriteY:544,spriteAlign:!0,priority:2,bounce:!1,piercing:!0,soundAttacks:"dopp_attacks",onInit:function(){this.spawnTimer=new c.Timer;this.spawnTimer.start(50)},onUpdate:function(a,b){this.spawnTimer.update(a);this.spawnTimer.expired()&&(b.spawnObject(this,"e_dopp_fire"),this.spawnTimer.reset())},ignoreLogDeath:!0};d.beholder={role:"monster",team:1,badass:!0,size:new c.Size(128,128),spriteSheet:"beholder",
animated:!0,animDelay:350,drawIndex:3,damage:30,hitPoints:3E3,speed:50,soundDamage:"beholder_damage",soundDies:"beholder_dies",achievementId:"defeatbeholder",deathsForAchievement:1,collidable:!1,lootTable:[{type:"item_weapon_fire_sword",weight:1}],onInit:function(){this.phaseTimer=new c.Timer;this.attackTimer=new c.Timer;this.eyeletOffset=100;this.eyeletOffsetMod=1;this.enraged=!1},onUpdate:function(a,b){this.attackTimer.update(a);if(this.attackTimer.expired()){c.sound.play("wizard_attacks");var d=
b.spawnObject(this,"e_energy_ball"),e=b.objects[d];e.chase(b.getPlayerObject());this.attackTimer.reset()}this.eyeletOffset+=0.02*a*this.eyeletOffsetMod;120<this.eyeletOffset&&(this.eyeletOffsetMod=-1);100>this.eyeletOffset&&(this.eyeletOffsetMod=1);this.wounds>this.hitPoints/2&&!this.enraged&&(this.enraged=!0,this.speed*=1.5,this.animDelay/=2,this.attackTimer.start(2E3));switch(this.phase){case 0:this.phaseInit||(this.speed=200,this.addState(c.Object.states.INVISIBLE),this.phaseInit=!0);70<=this.position.y&&
this.nextPhase();break;case 1:this.phaseInit||(c.sound.play("wizard_reappear"),this.speed=50,this.removeState(c.Object.states.INVISIBLE),this.addState(c.Object.states.INVINCIBLE),this.phaseTimer.start(2E3),this.phaseInit=!0);l.wander.apply(this,arguments);this.phaseTimer.expired()&&(this.attackTimer.start(4E3),this.nextPhase());break;case 2:this.phaseInit||(this.removeState(c.Object.states.INVINCIBLE),this.collidable=!0,this.eyeletTimer=new c.Timer,this.eyeletTimer.start(500),this.eyeletsSpawned=
0,this.phaseInit=!0);this.eyeletTimer.update(a);l.wander.apply(this,arguments);this.eyeletTimer.expired()&&(c.sound.play("wizard_reappear"),this.eyeletTimer.reset(),d=b.spawnObject(this,"eyelet"),this.wounds>this.hitPoints/2&&(e=b.objects[d],e.makeBadass()),++this.eyeletsSpawned,12<=this.eyeletsSpawned&&this.nextPhase());break;case 3:this.phaseInit||(this.phaseTimer.start(2E4),this.phaseInit=!0);e=!1;for(d in b.objects)if(b.objects[d].ownerId===this.id){e=!0;break}(this.phaseTimer.expired()||!e)&&
this.nextPhase();l.wander.apply(this,arguments);break;case 4:this.phaseInit||(this.stopMoving(),this.phaseTimer.start(2E3),this.phaseInit=!0);this.position.x+=c.randomRange(-2,2);this.phaseTimer.expired()&&this.nextPhase();break;case 5:for(d=0;2>d;++d)b.spawnObject(this,"gas_cloud");this.nextPhase();break;case 6:this.phaseInit||(this.oldSpeed=this.speed,this.speed=250,this.oldAnimDelay=this.animDelay,this.animDelay=100,this.chase(b.getPlayerObject()),this.phaseTimer.start(1E3),this.phaseInit=!0)}},
onWallCollide:function(){6===this.phase&&this.phaseTimer.expired()&&(this.speed=this.oldSpeed,this.animDelay=this.oldAnimDelay,this.setPhase(2))}};d.gas_cloud={role:"trap",team:1,animated:!0,size:new c.Size(128,128),spriteSheet:"characters",spriteX:640,spriteY:416,drawIndex:2,animDelay:400,damage:20,hitPoints:9999,speed:10,ttl:9E4,damageType:"magic",onInit:function(){this.setDirection(c.randomDirection());this.moveChangeDelay=c.randomRange(5E3,1E4)},onUpdate:function(a,b){2===this.animFrameIndex&&
(this.animated=!1,this.spriteX=896);1===this.team&&(!b.objects[this.ownerId]&&2E3<this.ttl-this.ttlElapsed)&&(this.ttlElapsed=this.ttl-2E3);l.wander.apply(this,arguments)},onObjectCollide:function(a){a.team!==this.team&&"projectile"!==a.role&&a.addState(c.Object.states.SLOWED,300);3!==this.team&&"magic"==a.damageType&&(c.sound.play("fire_attack"),this.ownerId=null,this.team=3,this.damage=5,this.ttl=2E3,this.ttlElapsed=0,this.spriteY+=224,this.animDelay=500,this.animFrameIndex=0,this.animNumFrames=
3)}};d.dragon={role:"monster",team:1,badass:!0,animated:!0,gibletSize:"large",size:new c.Size(64,64),spriteSheet:"characters",spriteY:352,moveChangeElapsed:0,moveChangeDelay:0,damage:20,hitPoints:1E3,speed:20,worth:0,soundAttacks:"dragon_attacks",soundDamage:"dragon_damage",soundDies:"dragon_dies",achievementId:"defeatdragon",deathsForAchievement:1,weapons:[{type:"e_fireball",count:null}],lootTable:[{type:"item_gold_chest",weight:1}],phase:0,phaseInit:!1,onInit:function(){this.phaseTimer=new c.Timer;
this.moveChangeDelay=c.randomRange(500,1E3);this.setDirection(c.directions.toVector(c.directions.DOWN));this.altTimer=new c.Timer},onUpdate:function(a,b){this.altTimer.update(a);switch(this.phase){case 0:this.phaseInit||(this.speed=200,this.animDelay=50,this.phaseInit=!0);200<=this.position.y&&(this.phase++,this.phaseInit=!1);break;case 1:this.phaseInit||(this.stopMoving(),this.animDelay=300,this.phaseTimer.start(1E3),this.phaseInit=!0);this.position.x+=c.randomRange(-1,1);this.phaseTimer.expired()&&
this.nextPhase();break;case 2:this.phaseInit||(this.cooldown=!1,this.stopMoving(),this.weapons=[{type:"e_ring_fire",count:null}],this.phaseInit=!1);b.objectAttack(this);this.nextPhase();break;case 3:this.phaseInit||(this.speed=0,this.animDelay=100,this.phaseTimer.start(2E3),this.phaseInit=!0,this.altTimer.start(350),this.followUpShot=!1);!this.followUpShot&&this.altTimer.expired()&&this.wounds>this.hitPoints/2&&(this.cooldown=!1,this.weapons=[{type:"e_ring_fire_dopp",count:null}],b.objectAttack(this),
this.followUpShot=!0);this.phaseTimer.expired()&&(this.phase++,this.phaseInit=!1);this.position.x+=c.randomRange(-1,1);break;case 4:if(!this.phaseInit){this.speed=350;this.animDelay=100;this.phaseTimer.start(500);this.phaseInit=!0;var d=b.getPlayerObject();this.chase(d)}this.phaseTimer.expired()&&(this.phase++,this.phaseInit=!1);break;case 5:return this.phaseInit||(this.speed=0,this.animDelay=400,this.weapons=[{type:"e_fireball_green",count:null}],this.cooldown=!1,this.cooldownElapsed=0,this.phaseTimer.start(2500),
this.phaseInit=!0,this.altTimer.start(750)),this.phaseTimer.expired()&&(this.phase=2,this.phaseInit=!1),d=b.getPlayerObject(),this.chase(d),this.altTimer.expired()&&this.wounds>this.hitPoints/2&&(b.spawnObject(this,"e_fireball"),this.altTimer.reset()),"shoot"}}};d.e_arrow={role:"projectile",cooldown:4E3,speed:200,hitPoints:1,damage:5,spriteSheet:"objects",spriteX:256,spriteY:0,spriteAlign:!0,bounce:!1,ignoreLogDeath:!0};d.e_trident={role:"projectile",cooldown:5E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",
spriteX:160,spriteY:0,spriteAlign:!0,bounce:!1,ignoreLogDeath:!0};d.e_boulder={role:"projectile",cooldown:2E3,speed:150,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:224,spriteY:0,rotate:!0,bounce:!1,ignoreLogDeath:!0};d.e_bouncing_boulder={role:"projectile",cooldown:1500,speed:150,hitPoints:Infinity,damage:15,spriteSheet:"objects",spriteX:224,spriteY:0,rotate:!0,bounce:!0,ttl:5E3,ignoreLogDeath:!0};d.e_minotaur_trident={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:20,
spriteAlign:!0,spriteSheet:"objects",spriteX:160,spriteY:0,bounce:!1,ignoreLogDeath:!0};d.e_energy_ball={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:25,spriteSheet:"objects",spriteX:320,spriteY:0,rotate:!0,bounce:!1,ignoreLogDeath:!0};d.e_ring_fire={role:"projectile",cooldown:2E3,speed:200,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:!0,bounce:!1,damageType:"magic",ignoreLogDeath:!0};d.e_ring_fire_dopp={role:"projectile",cooldown:2E3,speed:150,
hitPoints:Infinity,damage:25,spriteSheet:"objects",spriteX:352,spriteY:544,rotate:!0,bounce:!1,damageType:"magic",ignoreLogDeath:!0};d.e_fireball={role:"projectile",cooldown:2E3,speed:350,hitPoints:Infinity,damage:20,spriteSheet:"objects",spriteX:352,spriteY:544,rotate:!0,bounce:!1,damageType:"magic",ignoreLogDeath:!0};d.e_fireball_green={role:"projectile",cooldown:75,speed:350,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:352,spriteY:0,rotate:!0,ttl:400,bounce:!1,damageType:"magic",
ignoreLogDeath:!0};d.e_static_blue_fire={role:"projectile",cooldown:100,speed:0,hitPoints:Infinity,damage:5,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:!0,rotateSpeed:100,ttl:1E3,bounce:!1,drawIndex:0,damageType:"magic",ignoreLogDeath:!0};d.e_dopp_fire={role:"projectile",cooldown:200,speed:0,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:288,spriteY:32,rotate:!0,rotateSpeed:200,ttl:250,bounce:!1,drawIndex:0,damageType:"magic",ignoreLogDeath:!0};d.e_static_green_fire={role:"projectile",
cooldown:200,speed:0,hitPoints:Infinity,damage:10,size:new c.Size(64,64),spriteSheet:"objects",spriteX:64,spriteY:192,rotate:!0,rotateSpeed:150,ttl:2E3,bounce:!1,drawIndex:0,damageType:"magic",ignoreLogDeath:!0};d.e_dirt_pile={role:"trap",cooldown:100,speed:0,hitPoints:Infinity,damage:0,spriteSheet:"characters",spriteX:0,spriteY:448,ttl:3E3,bounce:!1,drawIndex:-2,onInit:function(){5<c.randomRange(1,10)&&(this.spriteX+=32)},onObjectCollide:function(a){a.team!==this.team&&"projectile"!==a.role&&a.addState(c.Object.states.SLOWED,
300)},ignoreLogDeath:!0};d.e_spit_pool={role:"trap",cooldown:100,speed:0,hitPoints:9999,damage:5,size:new c.Size(64,64),spriteSheet:"characters",spriteX:896,spriteY:416,animated:!0,ttl:7500,bounce:!1,drawIndex:-1,collidable:!1,onObjectCollide:function(a){a.team!==this.team&&"projectile"!==a.role&&a.addState(c.Object.states.SLOWED,300)},ignoreLogDeath:!0};d.e_shock_wave={role:"projectile",cooldown:1E3,speed:200,hitPoints:Infinity,damage:10,spriteSheet:"objects",spriteX:224,spriteY:32,spriteAlign:!0,
bounce:!1,animated:!0,damageType:"magic",ignoreLogDeath:!0};d.e_worm_spit={role:"projectile",cooldown:1E3,speed:200,hitPoints:1,damage:10,spriteSheet:"objects",spriteX:128,spriteY:64,spriteAlign:!0,bounce:!1,animated:!0,damageType:"magic",onInit:function(){this.dieTimer=new c.Timer;this.dieTimer.start(1E3)},onUpdate:function(a){this.dieTimer.update(a);this.dieTimer.expired()&&this.die()},onDelete:function(a){a.spawnObject(this,"e_spit_pool")},ignoreLogDeath:!0};d.mini_heart={role:"fluff",spriteSheet:"objects",
spriteX:288,spriteY:128,size:new c.Size(10,10),ttl:600,speed:75,collidable:!1,drawIndex:5,onInit:function(){this.setDirection(new c.Vector2(0,-1));this.speed=c.randomRange(55,85)}};d.mini_skull={role:"fluff",spriteSheet:"objects",spriteX:320,spriteY:128,size:new c.Size(10,10),ttl:1300,collidable:!1,drawIndex:5,onInit:function(){this.setDirection(new c.Vector2(0,-1));this.speed=c.randomRange(25,60)}};d.rose={role:"fluff",spriteSheet:"objects",collidable:!1,rotate:!0,spriteX:192,spriteY:256,drawIndex:-1,
onInit:function(){this.speed=c.randomRange(150,200);this.rotateSpeed=c.randomRange(75,100);this.phaseTimer=new c.Timer},onUpdate:function(){switch(this.phase){case 0:if(!this.phaseInit){this.phaseInit=!0;var a=c.randomRange(0,5);this.direction.y=-(a/10);this.phaseTimer.start(c.randomRange(500,1750))}this.direction.y+=0.01;this.phaseTimer.expired()&&this.nextPhase();break;case 1:this.phaseInit||(this.stopMoving(),this.rotate=!1,this.phaseInit=!0)}}};d.cloud={role:"fluff",spriteSheet:"objects",collidable:!1,
drawIndex:10,onInit:function(){this.alpha=0.25;this.speed=c.randomRange(5,25);this.size=new c.Size(192,128);switch(c.randomRange(1,4)){case 1:this.spriteX=0;this.spriteY=288;break;case 2:this.size=new c.Size(128,96);this.spriteX=192;this.spriteY=288;break;case 3:this.spriteX=0;this.spriteY=416;break;case 4:this.size=new c.Size(160,128),this.spriteX=192,this.spriteY=416}}};d.gate={role:"fluff",speed:25,spriteSheet:"objects",spriteX:0,spriteY:192,size:new c.Size(64,64)};d.pickup_arrow={role:"fluff",
speed:0,spriteSheet:"objects",spriteX:0,spriteY:608,size:new c.Size(118,52),drawIndex:9,animated:!0};d.item_food={role:"powerup_food",healAmount:10,speed:0,spriteSheet:"objects",spriteX:96,spriteY:32,ttl:8E3};d.item_coin={role:"powerup_coin",coinAmount:100,speed:0,spriteSheet:"objects",spriteX:64,spriteY:32,ttl:5E3};d.item_chest={role:"powerup_coin",coinAmount:500,speed:0,spriteSheet:"objects",spriteX:32,spriteY:32,ttl:5E3};d.item_gold_chest={role:"powerup_coin",coinAmount:5E3,speed:0,spriteSheet:"objects",
spriteX:0,spriteY:32};d.item_weapon_knife={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:32,spriteY:0,ttl:5E3,wepType:"h_knife",wepCount:125};d.item_weapon_spear={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:96,spriteY:0,ttl:5E3,wepType:"h_spear",wepCount:100};d.item_weapon_fireball={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:192,spriteY:0,ttl:5E3,wepType:"h_fireball",wepCount:100};d.item_weapon_axe={role:"powerup_weapon",speed:0,spriteSheet:"objects",
spriteX:192,spriteY:32,ttl:5E3,wepType:"h_axe",wepCount:75};d.item_weapon_fire_sword={role:"powerup_weapon",speed:0,spriteSheet:"objects",spriteX:384,spriteY:0,wepType:"h_fire_sword",wepCount:5E3};c.ImageLoader=function(){this.images={};this.numImages=this.numLoaded=0};d=c.ImageLoader.prototype;d.load=function(a,b,d){this.callback=function(){b.call(d)};for(var e in a)this.numImages++,this.images[e]=new Image,c.on("load",this.handleImageLoad,this.images[e],this),c.on("error",this.handleImageError,
this.images[e],this),this.images[e].src=a[e]};d.increment=function(){this.numLoaded++;this.numLoaded>=this.numImages&&this.callback()};d.handleImageLoad=function(){this.increment()};d.handleImageError=function(){this.increment()};d.getImage=function(a){return this.images[a]?this.images[a]:!1};c.SpawnPoint=function(a,b,d,e){this.delay=500;this.lastSpawnElapsed=0;this.location=new c.Rect(a,b,d,e);this.queue=[]};d=c.SpawnPoint.prototype;d.update=function(a,b){this.lastSpawnElapsed+=a;if(this.lastSpawnElapsed>=
this.delay||!0===b){this.lastSpawnElapsed=0;if(1>this.queue.length)return!1;var d=this.queue.shift(),e=this.location,d=c.makeObject(d);d.position.x=c.randomRange(e.left,e.left+e.width-d.size.width);d.position.y=c.randomRange(e.top,e.top+e.height-d.size.height);e=d.direction.clone();e.y=1;d.setDirection(e);return d}return!1};d.queueSpawn=function(a,b){for(var b=Number(b)||1,c=0;c<b;c++)this.queue.push(a)};c.SpawnWave=function(){this.points=[];this.nextWaveTime=2E4;this.bossWave=!1};d=c.SpawnWave.prototype;
d.addSpawnPoint=function(a,b){this.points.push({spawnPointId:a,delay:b,objects:[]})};d.addObjects=function(a,b,c){var d=null,e;for(e in this.points)this.points[e].spawnPointId===a&&(d=this.points[e]);if(null===d)return!1;d.objects.push({type:b,count:Math.floor(c)})};(new c.Engine).run()})();

	}());
	</script>

	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-16927444-5']);
	  _gaq.push(['_trackPageview']);
	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>

</body>
</html>
